{"version":3,"file":"share.min.js","sources":["custom.js","../https:/unpkg.com/@shgysk8zer0/kazoo@0.0.9/custom-elements.js","../https:/unpkg.com/@shgysk8zer0/kazoo@0.0.9/math.js","../https:/unpkg.com/@shgysk8zer0/kazoo@0.0.9/events.js","../https:/unpkg.com/@shgysk8zer0/kazoo@0.0.9/trust.js","../https:/unpkg.com/@shgysk8zer0/kazoo@0.0.9/dom.js","../https:/unpkg.com/@shgysk8zer0/kazoo@0.0.9/abort.js","../https:/unpkg.com/@shgysk8zer0/kazoo@0.0.9/promises.js","../https:/unpkg.com/@shgysk8zer0/kazoo@0.0.9/utility.js","../https:/unpkg.com/@shgysk8zer0/kazoo@0.0.9/attrs.js","../https:/unpkg.com/@shgysk8zer0/kazoo@0.0.9/meta.js","../https:/unpkg.com/@shgysk8zer0/kazoo@0.0.9/HTTPException.js","../https:/unpkg.com/@shgysk8zer0/kazoo@0.0.9/http.js","../https:/unpkg.com/@shgysk8zer0/kazoo@0.0.9/google-analytics.js","share.js"],"sourcesContent":["const protectedData = new WeakMap();\n\nexport const style = {\n\t'-webkit-appearance': 'button',\n\tappearance: 'button',\n\tdisplay: 'inline-block',\n\tcursor: 'pointer',\n};\n\nexport const states = {\n\tdisabled: '--disabled',\n};\n\nexport class HTMLCustomButtonElement extends HTMLElement {\n\tattachInternals() {\n\t\tconst internals = super.attachInternals();\n\t\tprotectedData.set(this, internals);\n\t\treturn internals;\n\t}\n\n\tget disabled() {\n\t\treturn this.hasAttribute('disabled');\n\t}\n\n\tset disabled(val) {\n\t\tthis.toggleAttribute('disabled', val);\n\t}\n\n\tattributeChangedCallback(name, oldVal, newVal) {\n\t\tif (name === 'disabled') {\n\t\t\tconst internals = protectedData.get(this);\n\n\t\t\tif (typeof newVal === 'string') {\n\t\t\t\tinternals.ariaDisabled = 'true';\n\t\t\t\tinternals.states.add(states.disabled);\n\t\t\t} else {\n\t\t\t\tinternals.ariaDisabled = 'false';\n\t\t\t\tinternals.states.delete(states.disabled);\n\t\t\t}\n\t\t}\n\t}\n\n\tconnectedCallback() {\n\t\tif (! protectedData.has(this)) {\n\t\t\tthis.attachInternals();\n\t\t}\n\n\t\tconst internals = protectedData.get(this);\n\n\t\tif (! (this.hasAttribute('role') || typeof internals.role === 'string')) {\n\t\t\tinternals.role = 'button';\n\t\t}\n\n\t\tif (! this.hasAttribute('tabindex')) {\n\t\t\tthis.tabIndex = 0;\n\t\t}\n\t}\n\n\tstatic get observedAttributes() {\n\t\treturn ['disabled'];\n\t}\n}\n","/**\n * @copyright 2023 Chris Zuber <admin@kernvalley.us>\n */\nexport const supported = window.customElements instanceof Object;\n\nexport function isDefined(...tags) {\n\treturn supported && tags.every(tag => typeof customElements.get(tag) !== 'undefined');\n}\n\nexport function registerCustomElement(tag, cls, ...rest) {\n\tif (! supported) {\n\t\tconsole.error(new Error('`customElements` not supported'));\n\t\treturn false;\n\t} else if (isDefined(tag)) {\n\t\tconsole.warn(new Error(`<${tag}> is already defined`));\n\t\t// Returns true/false if element being registered matches given class\n\t\treturn customElements.get(tag) === cls;\n\t} else {\n\t\tcustomElements.define(tag, cls, ...rest);\n\t\treturn true;\n\t}\n}\n\nexport async function getCustomElement(tag) {\n\tif (supported) {\n\t\tawait customElements.whenDefined(tag);\n\t\treturn customElements.get(tag);\n\t} else {\n\t\tthrow new Error('`customElements` not supported');\n\t}\n}\n\nexport async function createCustomElement(tag, ...args) {\n\tconst Pro = await getCustomElement(tag);\n\treturn new Pro(...args);\n}\n\nexport async function whenDefined(...els) {\n\tif (supported) {\n\t\tawait Promise.all(els.map(el => customElements.whenDefined(el)));\n\t} else {\n\t\tthrow new Error('`customElements` not supported');\n\t}\n}\n\nexport async function defined(...els) {\n\tconsole.error('`defined()` is deprecated. Please use `whenDefined()` instead');\n\tawait whenDefined(...els);\n}\n","/**\n * @copyright 2023 Chris Zuber <admin@kernvalley.us>\n */\nexport const isNumber = num => typeof num === 'number' && ! Number.isNaN(num);\n\nexport const divisibleBy = (num, divisor) => isNumber(num) && num % divisor === 0;\n\nexport const even = num => divisibleBy(num, 2);\n\nexport const odd = num => ! even(num);\n\nexport const between = (min, val, max) => isNumber(val) && val >= min && val <= max;\n\nexport const clamp = (min, value, max) => Math.min(max, Math.max(min, value));\n\nexport const uint8 = n => Math.min(0, parseInt(n) % 255);\n\nexport const uint8clamped = n => clamp(0, parseInt(n), 255);\n\nexport const toHex = val => uint8clamped(val).toString(16).padStart(2, '0');\n\nconst supportsRange = () => 'Iterator' in globalThis && (globalThis.Iterator.range instanceof Function);\n\n/**\n * @deprecated\n */\nexport function range(start, end, step = 1) {\n\tconsole.warn('range() is deprecated. Use `Iterator.range()` instead.');\n\tif (supportsRange()) {\n\t\treturn Iterator.range(start, end, { step });\n\t} else {\n\t\tthrow new DOMException('`Iterator.range()` not supported.');\n\t}\n}\n\n/**\n * Note: Requires iterator helper methods & `Iterator.range()`\n */\nexport function isPrime(n) {\n\tif (! supportsRange()) {\n\t\tthrow new DOMException('`Iterator.range()` not supported.');\n\t} else if (! Number.isSafeInteger(n) || n < 2) {\n\t\treturn false;\n\t} else if (n === 2 || n === 3 || n === 5 || n === 7) {\n\t\treturn true;\n\t} else if (n % 2 === 0) {\n\t\treturn false;\n\t} else {\n\t\tconst sqrtAndOne = Math.floor(Math.sqrt(n)) + 1;\n\t\treturn ! Iterator.range(3, sqrtAndOne, { step: 2 }).some(f => n % f === 0);\n\t}\n}\n\n/**\n * Note: Requires iterator helper methods & `Iterator.range()`\n */\nexport const primes = (start = 2, end = Infinity) => Iterator.range(start, end).filter(isPrime);\n\nexport function* fibonacci(terms = Number.MAX_SAFE_INTEGER) {\n\tif (! (Number.isSafeInteger(terms) && terms > 0)) {\n\t\tthrow new TypeError('Invalid terms given');\n\t}\n\n\tlet current = 1, prev = 1;\n\tyield 1;\n\n\tfor (let term = 1; term < terms; term++) {\n\t\tyield current;\n\t\t[prev, current] = [current, current + prev];\n\t}\n}\n\nexport function randomFloat(min, max) {\n\t[min, max] = [Math.min(min, max), Math.max(min, max)];\n\treturn Math.random() * (max - min + 1) + min;\n}\n\nexport function randomInt() {\n\treturn crypto.getRandomValues(new Uint32Array(1))[0];\n}\n\nexport function* rng({ length = 32 } = {}) {\n\twhile(true) {\n\t\tfor (const num of crypto.getRandomValues(new Uint8Array(length))) {\n\t\t\tyield num;\n\t\t}\n\t}\n}\n\nexport function* rng16({ length = 32 } = {}) {\n\twhile(true) {\n\t\tfor (const num of crypto.getRandomValues(new Uint16Array(length))) {\n\t\t\tyield num;\n\t\t}\n\t}\n}\n\nexport function* rng32({ length = 32 } = {}) {\n\twhile(true) {\n\t\tfor (const num of crypto.getRandomValues(new Uint32Array(length))) {\n\t\t\tyield num;\n\t\t}\n\t}\n}\n\nexport function sigma(start, end, callback) {\n\treturn Iterator.range(start, end).map(callback).reduce((sum, n) => sum + n);\n}\n\nexport function sum(...nums) {\n\treturn nums.reduce((sum, num) => sum + num);\n}\n\nexport function product(...nums) {\n\treturn nums.reduce((prod, num) => prod * num);\n}\n\nexport function mean(...nums) {\n\treturn sum(...nums) / nums.length;\n}\n\nexport function variance(...nums) {\n\tif (nums.length <= 1) {\n\t\treturn 0;\n\t}\n\tconst m = mean(...nums);\n\treturn nums.reduce((sum, num) => sum + (num - m)**2, 0) / (nums.length - 1);\n}\n\nexport function standardDeviation(...nums) {\n\treturn Math.sqrt(variance(...nums));\n}\n\nexport function choose(n, k) {\n\tif (k === 0 || k === n) {\n\t\treturn 1;\n\t} else if (! (Number.isInteger(n) && Number.isInteger(k))) {\n\t\treturn NaN;\n\t}\n\treturn factorial(n) / (k * factorial(n - k));\n}\n\nexport function factorial(n) {\n\tif (! Number.isInteger(n)) {\n\t\treturn NaN;\n\t} else if (n > 1) {\n\t\treturn n * factorial(n - 1);\n\t} else if (n === 1 || n === 0) {\n\t\treturn 1;\n\t} else {\n\t\treturn undefined;\n\t}\n}\n","/**\n * @copyright 2023 Chris Zuber <admin@kernvalley.us>\n */\nimport { query, when } from './dom.js';\nimport { signalAborted } from './abort.js';\nimport { getDeferred } from './promises.js';\nimport { debounce as db, throttle } from './utility.js';\n\nexport async function loaded(target, {\n\tsignal: passedSignal,\n\tsuccess = 'load',\n\terror = 'error',\n} = {}) {\n\treturn await new Promise(async (resolve, reject) => {\n\t\tif (passedSignal instanceof AbortSignal && passedSignal.aborted) {\n\t\t\treject(passedSignal.reason);\n\t\t} else if (target instanceof HTMLScriptElement && target.noModule && HTMLScriptElement.supports('module')) {\n\t\t\t/**\n\t\t\t * <script nomodule> will never load\n\t\t\t */\n\t\t\tresolve(target);\n\t\t} else if (target instanceof HTMLLinkElement && target.disabled) {\n\t\t\t/**\n\t\t\t * <link disabled> will never load\n\t\t\t */\n\t\t\tresolve(target);\n\t\t} else if (target instanceof HTMLImageElement && target.loading === 'lazy' && !(target.parentElement instanceof Element)) {\n\t\t\t/**\n\t\t\t * <img loading=\"lazy\"> will not load until appended\n\t\t\t */\n\t\t\tresolve(target);\n\t\t} else if (target instanceof HTMLImageElement && target.decode instanceof Function) {\n\t\t\tawait target.decode();\n\t\t\treturn target;\n\t\t} else {\n\t\t\tconst controller = new AbortController();\n\t\t\tconst signal = passedSignal instanceof AbortSignal ? AbortSignal.any([\n\t\t\t\tpassedSignal,\n\t\t\t\tcontroller.signal,\n\t\t\t]) : passedSignal;\n\n\t\t\tlisten(target, success, ({ target }) => {\n\t\t\t\tresolve(target);\n\t\t\t\tcontroller.abort();\n\t\t\t}, { once: true, signal });\n\n\t\t\tlisten(target, error, ({ target: { tagName, src, href} }) => {\n\t\t\t\tconst error = new Error(`Failed to load <${tagName.toLowerCase()}>`, {\n\t\t\t\t\tcause: new Error(`Request to ${src || href} failed`),\n\t\t\t\t});\n\n\t\t\t\treject(error);\n\t\t\t\tcontroller.abort(error);\n\t\t\t}, { once: true, signal });\n\n\t\t\tif (passedSignal instanceof AbortSignal) {\n\t\t\t\tlisten(passedSignal, 'abort', ({ target: { reason }}) => {\n\t\t\t\t\tif (! controller.signal.aborted) {\n\t\t\t\t\t\treject(reason);\n\t\t\t\t\t\tcontroller.abort(reason);\n\t\t\t\t\t}\n\t\t\t\t}, { once: true, signal: controller.signal });\n\t\t\t}\n\t\t}\n\t});\n}\n\nexport function getEventFeatures() {\n\tconst el = document.createElement('div');\n\tconst eventFeatures = {\n\t\tnativeSignal: 'AbortController' in globalThis && AbortController.prototype.hasOwnProperty('signal'),\n\t\tsignal: false,\n\t\tpassive: false,\n\t\tcapture: false,\n\t\tonce: false,\n\t};\n\n\t// Use of a getter will detect support when properties are read\n\tconst options = {\n\t\tget passive() {\n\t\t\teventFeatures.passive = true;\n\t\t\treturn undefined;\n\t\t},\n\t\tget signal() {\n\t\t\teventFeatures.signal = true;\n\t\t\treturn undefined;\n\t\t},\n\t\tget capture() {\n\t\t\teventFeatures.capture = true;\n\t\t\treturn undefined;\n\t\t},\n\t\tget once() {\n\t\t\teventFeatures.once = true;\n\t\t\treturn undefined;\n\t\t},\n\t};\n\n\ttry {\n\t\tel.addEventListener('click', null, options);\n\t\tel.removeEventListener('click', null, options);\n\t} catch(err) {\n\t\tconsole.error(err);\n\t}\n\n\treturn Object.seal(eventFeatures);\n}\n\nexport const features = getEventFeatures();\n\nexport function addListener(targets, events, callback, { capture, once, passive, signal } = {}) {\n\tif (! Array.isArray(targets)) {\n\t\ttargets = query(targets);\n\t}\n\n\tif (! Array.isArray(events)) {\n\t\tevents = Array.of(events);\n\t}\n\n\ttargets.forEach(target => {\n\t\tevents.forEach(event => listen(target, event, callback, { capture, once, passive, signal }));\n\t});\n}\n\nexport function listen(target, event, callback, { capture, once, passive, signal } = {}) {\n\tif (! (signal instanceof EventTarget && signal.aborted)) {\n\t\ttarget.addEventListener(event, callback, { capture, once, passive, signal });\n\n\t\tif (features.signal === false && signal instanceof EventTarget) {\n\t\t\tsignalAborted(signal).finally(() => target.removeEventListener(event, callback, { capture, once, passive, signal }));\n\t\t}\n\t}\n}\n\nexport async function once(target, event, { capture, passive, signal } = {}) {\n\tconst { resolve, promise } = getDeferred({ signal, reason: new DOMException('Operation aborted') });\n\tlisten(target, event, resolve, { capture, once: true, passive, signal });\n\treturn await promise;\n}\n\nexport function removeListener(targets, events, callback, { capture, once, passive, signal } = {}) {\n\tif (! Array.isArray(targets)) {\n\t\ttargets = query(targets);\n\t}\n\n\tif (! Array.isArray(events)) {\n\t\tevents = Array.of(events);\n\t}\n\n\ttargets.forEach(target => {\n\t\tevents.forEach(event => target.removeEventListener(event, callback, { capture, once, passive, signal }));\n\t});\n}\n\n/**\n * Control the execution rate of callbacks, i.e. for listeners\n * https://davidwalsh.name/function-debounce\n *\n * @param  Callable callback    The callback\n * @param  int      [ms]        Number of milliseconds, defaulting to 1/60th a second\n * @param  bool     [immediate] Trigger function immediately instead of after wait ms\n * @return function             Rate limited function\n */\nexport function debounce(func, wait = 17, immediate = false) {\n\tconsole.warn('debounce() in events.js is deprecated. Please use utility.js instead.');\n\treturn immediate ? throttle(func, { delay: wait }): db(func, { delay: wait });\n}\n\nexport async function whenOnline({ signal } = {}) {\n\tif (navigator.onLine === false) {\n\t\tawait when(window, 'online', { signal });\n\t}\n}\n\nexport async function whenOffline({ signal } = {}) {\n\tif (navigator.onLine === true) {\n\t\tawait when(window, 'offline', { signal });\n\t}\n}\n\nexport async function whenVisible({ signal } = {}) {\n\tif (document.visibilityState === 'hidden') {\n\t\tawait when(document, 'visibilitychange', { signal });\n\t}\n}\n\nexport async function whenHidden({ signal } = {}) {\n\tif (document.visibilityState === 'visible') {\n\t\tawait when(document, 'visibilitychange', { signal });\n\t}\n}\n\nexport async function* yieldEvents(target, event, { capture, passive, signal } = {}) {\n\tconst pending = [];\n\tconst def = {};\n\n\tif (! (signal instanceof AbortSignal)) {\n\t\tthrow new TypeError('`signal` required to be an `AbortSignal`.');\n\t}\n\n\ttarget.addEventListener(event, ev => {\n\t\tif (def.resolve instanceof Function) {\n\t\t\tconst resolve = def.resolve;\n\t\t\tdelete def.resolve;\n\t\t\tresolve(ev);\n\t\t} else {\n\t\t\tpending.push(ev);\n\t\t}\n\t}, { capture, passive, signal });\n\n\twhile (! signal.aborted) {\n\t\twhile (pending.length !== 0 && ! signal.aborted) {\n\t\t\tyield pending.shift();\n\t\t}\n\n\t\tif (! (def.resolve instanceof Function)) {\n\t\t\tconst { resolve, promise, reject } = getDeferred();\n\t\t\tdef.resolve = resolve;\n\t\t\tdef.reject = reject;\n\t\t\tdef.promise = promise;\n\t\t}\n\n\t\tyield await def.promise;\n\t}\n\n\treturn pending;\n}\n","/**\n * @copyright 2023 Chris Zuber <admin@kernvalley.us>\n */\nimport { callOnce } from './utility.js';\n\nexport function setProp(el, prop, val, {\n\tpolicy,\n} = {}) {\n\tswitch(getPropertyType(el.tagName, prop)) {\n\t\tcase 'TrustedScript':\n\t\t\tel[prop] = createScript(val, { policy });\n\t\t\tbreak;\n\n\t\tcase 'TrustedScriptURL':\n\t\t\tel[prop] = createScriptURL(val, { policy });\n\t\t\tbreak;\n\n\t\tcase 'TrustedHTML':\n\t\t\tel[prop] = createHTML(val, { policy });\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tel[prop] = val;\n\t}\n}\n\nexport function setAttr(el, attr, val, {\n\telementNs,\n\tpolicy,\n} = {}) {\n\tswitch(getAttributeType(el.tagName, attr, elementNs)) {\n\t\tcase 'TrustedScriptURL':\n\t\t\tif (typeof elementNs === 'string') {\n\t\t\t\tel.setAttributeNs(elementNs, attr, createScriptURL(val, { policy }));\n\t\t\t} else {\n\t\t\t\tel.setAttribute(attr, createScriptURL(val, { policy }));\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase 'TrustedScript':\n\t\t\tif (typeof elementNs === 'string') {\n\t\t\t\tel.setAttributeNS(elementNs, attr, createScript(val, { policy }));\n\t\t\t} else {\n\t\t\t\tel.setAttribute(attr, createScript(val, { policy }));\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase 'TrustedHTML':\n\t\t\tif (typeof elementNs === 'string') {\n\t\t\t\tel.setAttributeNS(elementNs, attr, createHTML(val, { policy }));\n\t\t\t} else {\n\t\t\t\tel.setAttribute(attr, createHTML(val, { policy }));\n\t\t\t}\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tif (typeof elementNs === 'string') {\n\t\t\t\tel.setAttributeNS(elementNs, attr, val);\n\t\t\t} else {\n\t\t\t\tel.setAttribute(attr, val);\n\t\t\t}\n\t}\n}\n\nexport function supported() {\n\treturn 'trustedTypes' in globalThis\n\t\t&& trustedTypes instanceof EventTarget\n\t\t&& trustedTypes.createPolicy instanceof Function;\n}\n\nexport function isTrustPolicy(policy) {\n\tif ('TrustedTypePolicy' in globalThis && policy instanceof TrustedTypePolicy) {\n\t\treturn true;\n\t} else {\n\t\treturn policy != null && policy.createHTML instanceof Function;\n\t}\n}\n\nexport function hasDefaultPolicy() {\n\treturn supported() && isTrustPolicy(trustedTypes.defaultPolicy);\n}\n\nexport function getAttributeType(tagName, attribute, elementNs) {\n\tif (supported()) {\n\t\treturn trustedTypes.getAttributeType(tagName.toLowerCase(), attribute, elementNs);\n\t} else {\n\t\treturn null;\n\t}\n}\n\nexport function getPropertyType(tagName, property) {\n\tif (supported()) {\n\t\treturn trustedTypes.getPropertyType(tagName.toLowerCase(), property);\n\t} else {\n\t\treturn null;\n\t}\n}\n\nexport function isHTML(input) {\n\tif (supported()) {\n\t\treturn trustedTypes.isHTML(input);\n\t} else {\n\t\treturn typeof input === 'string';\n\t}\n}\n\nexport function isScript(input) {\n\tif (supported()) {\n\t\treturn trustedTypes.isScript(input);\n\t} else {\n\t\treturn typeof input === 'string';\n\t}\n}\n\nexport function isScriptURL(input) {\n\tif (supported()) {\n\t\treturn trustedTypes.isScriptURL(input);\n\t} else {\n\t\treturn typeof input === 'string' || input instanceof URL;\n\t}\n}\n\nexport function isTrustedType(input) {\n\tif (supported()) {\n\t\treturn trustedTypes.isHTML(input) || trustedTypes.isScript(input) || trustedTypes.isScriptURL(input);\n\t} else {\n\t\treturn true;\n\t}\n}\n\nexport function createHTML(input, { policy = getDefaultPolicy() } = {}) {\n\tif (isTrustPolicy(policy) && ! isHTML(input)) {\n\t\treturn policy.createHTML(input);\n\t} else {\n\t\treturn input;\n\t}\n}\n\nexport function createScript(input, { policy = getDefaultPolicy() } = {}) {\n\tif (isTrustPolicy(policy) && ! isScript(input)) {\n\t\treturn policy.createScript(input);\n\t} else {\n\t\treturn input;\n\t}\n}\n\nexport function createScriptURL(input, { policy = getDefaultPolicy() } = {}) {\n\tif (isTrustPolicy(policy) && ! isScriptURL(input)) {\n\t\treturn policy.createScriptURL(input);\n\t} else {\n\t\treturn input;\n\t}\n}\n\nexport function createPolicy(name, {\n\tcreateHTML = () => {\n\t\tthrow new TypeError('This policy does not provide `createHTML()`');\n\t},\n\tcreateScript = () => {\n\t\tthrow new TypeError('This policy does not provide `createScript()`');\n\t},\n\tcreateScriptURL = () => {\n\t\tthrow new TypeError('This policy does not provide `createScriptURL()`');\n\t},\n}) {\n\tif (supported()) {\n\t\treturn trustedTypes.createPolicy(name, { createHTML, createScript, createScriptURL });\n\t} else {\n\t\treturn Object.freeze({\n\t\t\tname,\n\t\t\tcreateHTML: (input, ...args) => createHTML(input.toString(), ...args),\n\t\t\tcreateScript: (input, ...args) => createScript(input.toString(), ...args),\n\t\t\tcreateScriptURL: (input, ...args) => createScriptURL(input.toString(), ...args),\n\t\t});\n\t}\n}\n\nexport function getDefaultPolicy() {\n\tif (supported()) {\n\t\treturn trustedTypes.defaultPolicy;\n\t} else {\n\t\treturn null;\n\t}\n}\n\nexport const createHTMLPolicyGetter = (name, cb) => callOnce(() => createPolicy(name, { createHTML: cb }));\n\nexport const createScriptPolicyGetter = (name, cb) => callOnce(() => createPolicy(name, { createScript: cb }));\n\nexport const createScriptURLPolicyGetter = (name, cb) => callOnce(() => createPolicy(name, { createScriptURL: cb }));\n","/**\n * @copyright 2021-2023 Chris Zuber <admin@kernvalley.us>\n */\nimport { signalAborted } from './abort.js';\nimport { addListener, listen } from './events.js';\nimport { getDeferred, isAsync } from './promises.js';\nimport { isHTML, isTrustPolicy } from './trust.js';\nimport { HTML } from './types.js';\nimport { errorToEvent, callOnce, isNullish, isIterable } from './utility.js';\nimport { data as setData, css as setCss, attr as setAttr, aria as setAria } from './attrs.js';\n\nexport const readyStates = ['loading', 'interactive', 'complete'];\n\nexport const readyStateIndex = (state = document.readyState) => readyStates.indexOf(state);\n\nexport const reachedState = state => ! readyStateIndex(document.readyState) > readyStateIndex(state);\n\nexport function query(what, base = document) {\n\tif (Array.isArray(what)) {\n\t\treturn what;\n\t} else if (what instanceof EventTarget) {\n\t\treturn [what];\n\t} else if (typeof what === 'string') {\n\t\tconst matches = Array.from(base.querySelectorAll(what));\n\n\t\tif (base.matches instanceof Function && base.matches(what)) {\n\t\t\tmatches.push(base);\n\t\t}\n\t\treturn matches;\n\t} else if (isIterable(what)) {\n\t\treturn Array.from(what);\n\t} else {\n\t\tthrow new TypeError('Invalid \"what\" given to query()');\n\t}\n}\n\nexport function nth(what, n, { base } = {}) {\n\treturn query(what, base).at(n);\n}\n\nexport function first(what, base) {\n\treturn nth(what, 0, { base });\n}\n\nexport function last(what, base) {\n\treturn nth(what, -1, { base });\n}\n\nexport function each(what, callback, { base } = {}) {\n\tconst items = query(what, base);\n\titems.forEach(callback);\n\treturn items;\n}\n\nexport function map(what, callback, { base } = {}) {\n\treturn query(what, base).map(callback);\n}\n\nexport function some(what, callback, { base } = {}) {\n\treturn query(what, base).some(callback);\n}\n\nexport function every(what, callback, { base } = {}) {\n\treturn query(what, base).every(callback);\n}\n\nexport function find(what, callback, { base } = {}) {\n\treturn query(what, base).find(callback);\n}\n\nexport function filter(what, callback, { base } = {}) {\n\treturn query(what, base).filter(callback);\n}\n\nexport function groupToMap(what, callback, { base } = {}) {\n\treturn query(what, base).groupToMap(callback);\n}\n\nexport function group(what, callback, { base } = {}) {\n\treturn query(what, base).group(callback);\n}\n\nexport function append(parent, ...nodes) {\n\tparent.append(...nodes);\n}\n\nexport function remove(what, { base } = {}) {\n\treturn each(what, item => item.remove(), { base });\n}\n\nexport function meta({ name, itemprop, property, charset, content }) {\n\tconst meta = document.createElement('meta');\n\n\tif (typeof name === 'string') {\n\t\tmeta.name = name;\n\t\tmeta.content = content;\n\t} else if (typeof itemprop === 'string') {\n\t\tmeta.setAttribute('itemprop', itemprop);\n\t\tmeta.content = content;\n\t} else if (typeof property === 'string') {\n\t\tmeta.setAttribute('property', property);\n\t\tmeta.content = content;\n\t} else if (typeof charset === 'string') {\n\t\tmeta.setAttribute('charset', charset);\n\t} else {\n\t\tthrow new Error('Meta must have either name, itemprop, property, or charset given');\n\t}\n\n\treturn meta;\n}\n\nexport function css(what, props = {}, { base, priority } = {}) {\n\treturn each(what, item => setCss(item, props, { priority }), { base });\n}\n\nexport function aria(what, props ={}, { base } = {}) {\n\teach(what, item => setAria(item, props), { base });\n}\n\nexport function data(what, props = {}, { base } = {}) {\n\treturn each(what, item => setData(item, props), { base });\n}\n\nexport function attr(what, props = {}, { base, namespace = null, policy } = {}) {\n\treturn each(what, item => setAttr(item, props, { namespace, policy }), { base });\n}\n\nexport function toggleAttr(what, attrs, { base, force, signal } = {}) {\n\tif (! Array.isArray(attrs)) {\n\t\tattrs = [attrs];\n\t}\n\tconst items = query(what, base);\n\n\tif (! (signal instanceof AbortSignal)) {\n\t\titems.forEach(item => attrs.forEach(attr => item.toggleAttribute(attr, force)));\n\t} else if (signal.aborted) {\n\t\titems.forEach(item => attrs.forEach(attr => item.removeAttribute(attr)));\n\t} else {\n\t\tif (typeof force !== 'boolean') {\n\t\t\tforce = true;\n\t\t}\n\n\t\titems.forEach(item => attrs.forEach(attr => item.toggleAttribute(attr, force)));\n\n\t\tsignal.addEventListener('abort', () => {\n\t\t\titems.forEach(item => attrs.forEach(attr => item.toggleAttribute(attr, !force)));\n\t\t}, { once: true });\n\t}\n\treturn items;\n}\n\nexport function disable(what, { base, value = true } = {}) {\n\treturn each(what, el => el.disabled = value, { base });\n}\n\nexport function enable(what, { base, value = false } = {}) {\n\treturn disable(what, { base, value });\n}\n\nexport function hide(what, { base, value = true } = {}) {\n\treturn each(what, el => el.hidden = value, { base });\n}\n\nexport function unhide(what, { base, value = false } = {}) {\n\treturn hide(what, { base, value });\n}\n\nexport function value(what, value, { base } = {}) {\n\tif (value == null) {\n\t\treturn each(what, el => el.removeAttribute('value'), { base });\n\t} else {\n\t\treturn each(what, el => el.value = value, { base });\n\t}\n}\n\nexport function addClass(what, ...args) {\n\treturn each(what, el => el.classList.add(...args));\n}\n\nexport function removeClass(what, ...args) {\n\treturn each(what, el => el.classList.remove(...args));\n}\n\nexport function toggleClass(what, classes = {}, { base, force } = {}) {\n\treturn each(what, item => {\n\t\tif (typeof classes === 'string') {\n\t\t\treturn item.classList.toggle(classes, force);\n\t\t} else if (Array.isArray(classes)) {\n\t\t\tclasses.forEach(cn => item.classList.toggle(cn, force));\n\t\t} else {\n\t\t\tObject.entries(classes).forEach(([cl, cond]) => {\n\t\t\t\tif (cond instanceof Function) {\n\t\t\t\t\titem.classList.toggle(cl, cond.apply(what, [cl]));\n\t\t\t\t} else if (cond instanceof AbortSignal) {\n\t\t\t\t\tif (cond.aborted) {\n\t\t\t\t\t\titem.classList.remove(cl);\n\t\t\t\t\t} else {\n\t\t\t\t\t\titem.classList.add(cl, true);\n\t\t\t\t\t\tcond.addEventListener('abort', () => {\n\t\t\t\t\t\t\titem.classList.remove(cl);\n\t\t\t\t\t\t}, { once: true });\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\titem.classList.toggle(cl, cond);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}, { base });\n}\n\nexport function replaceClass(what, classes = {}, { base } = {}) {\n\tconst entries = Object.entries(classes);\n\n\treturn each(what, item => {\n\t\tentries.forEach(([from, to]) => item.classList.replace(from, to));\n\t}, { base });\n}\n\nexport function text(what, text, { base } = {}) {\n\treturn each(what, el => el.textContent = text, { base });\n}\n\nexport function html(what, text, {\n\tbase,\n\tsanitizer,\n\tpolicy = 'trustedTypes' in globalThis ? globalThis.trustedTypes.defaultPolicy : undefined,\n} = {}) {\n\tif (typeof sanitizer !== 'undefined' && Element.prototype.setHTML instanceof Function) {\n\t\treturn each(what, el => el.setHTML(text, { sanitizer }), { base });\n\t} else if (isHTML(text)) {\n\t\treturn each(what, el => el.innerHTML = text, { base });\n\t} else if (! isNullish(policy) && policy.createHTML instanceof Function) {\n\t\ttext = policy.createHTML(text);\n\t\treturn each(what, el => el.innerHTML = text, { base });\n\t} else {\n\t\treturn each(what, el => el.innerHTML = text, { base });\n\t}\n}\n\nexport function on(what, when, ...args) {\n\t// @TODO: Figure out a way of adding `base` to arguments\n\tconst items = query(what);\n\n\tif (typeof when === 'string') {\n\t\taddListener(items, [when], ...args);\n\t} else if (Array.isArray(when)) {\n\t\taddListener(items, when, ...args);\n\t} else {\n\t\tObject.entries(when).forEach(([ev, cb]) => addListener(items, [ev], cb, ...args));\n\t}\n\n\treturn items;\n}\n\nexport function prevent(what, event = ['submit'], { signal, capture } = {}) {\n\treturn on(what, event, ev => ev.preventDefault(), { signal, capture });\n}\n\nexport function off(what, when, ...args) {\n\treturn each(what, item => {\n\t\tif (typeof when === 'string') {\n\t\t\titem.removeEventListener(when, ...args);\n\t\t} else if (Array.isArray(when)) {\n\t\t\twhen.forEach(e =>  item.removeEventListener(e, ...args));\n\t\t} else {\n\t\t\tObject.entries(when).forEach(([ev, cb]) => item.removeEventListener(ev, cb, ...args));\n\t\t}\n\t});\n}\n\nexport async function when(what, events, { capture, passive, signal, base } = {}) {\n\tconst controller = new AbortController();\n\tconst { promise, resolve, reject } = getDeferred();\n\n\tif (signal instanceof AbortSignal) {\n\t\tif (signal.aborted) {\n\t\t\tcontroller.abort(signal.reason);\n\t\t} else {\n\t\t\taddEventListener([signal], ['abort'], () => {\n\t\t\t\tcontroller.abort(signal.reason);\n\t\t\t\treject(signal.reason);\n\t\t\t}, { once: true, signal: controller.signal });\n\t\t}\n\t}\n\n\tif (controller.signal.aborted) {\n\t\treject(controller.signal.reason);\n\t} else {\n\t\ton(query(what, base), events, event => {\n\t\t\tresolve(event);\n\t\t\tcontroller.abort();\n\t\t}, { capture, passive, signal: controller.signal });\n\t}\n\n\treturn promise;\n}\n\nexport const ready = callOnce(async function ready({ signal } = {}) {\n\tconst { promise, resolve, reject } = getDeferred();\n\n\tif (signal instanceof AbortSignal && signal.aborted) {\n\t\treject(signal.reason || new DOMException('Operation aborted.'));\n\t} else if (readyStateIndex() === 0) {\n\t\tlisten(document, 'DOMContentLoaded', resolve, { signal, once: true, capture: true });\n\n\t\tif (signal instanceof AbortSignal) {\n\t\t\tsignal.addEventListener('abort',\n\t\t\t\t({ target }) => reject(target.reason || new DOMException('Operation aborted.')),\n\t\t\t\t{ once: true }\n\t\t\t);\n\t\t}\n\t} else {\n\t\tresolve();\n\t}\n\n\treturn promise;\n});\n\nexport async function whenReadyState(state, { signal } = {}) {\n\tconst { resolve, reject, promise } = getDeferred();\n\tconst stateIndex = readyStateIndex(state);\n\n\tif (signal instanceof AbortSignal && signal.aborted) {\n\t\treject(signal.reason || new DOMException('Operation aborted.'));\n\t} else if (stateIndex < 0) {\n\t\treject(new DOMException(`Invalid state: ${state}`));\n\t} else if (stateIndex > readyStateIndex()) {\n\t\tconst controller = new AbortController();\n\t\tlet settled = false;\n\n\t\tcontroller.signal.addEventListener('abort', ({ target }) => {\n\t\t\tif (! settled) {\n\t\t\t\treject(target.reason || new DOMException('Operation aborted.'));\n\t\t\t\tsettled = true;\n\t\t\t}\n\t\t}, { once: true });\n\n\t\tif (signal instanceof AbortSignal) {\n\t\t\tsignal.addEventListener('abort', ({ target }) => {\n\t\t\t\tcontroller.abort(target.reason);\n\t\t\t}, { once: true, signal: controller.signal });\n\t\t}\n\n\t\tdocument.addEventListener('readystatechange', () => {\n\t\t\tif (document.readyState === state) {\n\t\t\t\tresolve();\n\t\t\t\tsettled = true;\n\t\t\t\tcontroller.abort();\n\t\t\t}\n\t\t}, { signal: controller.signal });\n\t} else {\n\t\tresolve();\n\t}\n\n\treturn promise;\n}\n\nexport const interactive =  callOnce(async function interactive({ signal } = {}) {\n\tawait whenReadyState('interactive', { signal });\n});\n\nexport const complete = callOnce(async function complete({ signal } = {}) {\n\tawait whenReadyState('complete', { signal });\n});\n\nexport const loaded =  callOnce(async function loaded({ signal } = {}) {\n\tconst { promise, resolve, reject } = getDeferred();\n\n\tif (signal instanceof AbortSignal && signal.aborted) {\n\t\treject(signal.reason || new DOMException('Operation aborted.'));\n\t} else if (readyStateIndex() < 2) {\n\t\tlisten(globalThis, 'load', resolve, { signal, once: true, capture: true });\n\n\t\tif (signal instanceof AbortSignal) {\n\t\t\tsignal.addEventListener('abort',\n\t\t\t\t({ target }) => reject(target.reason || new DOMException('Operation aborted.')),\n\t\t\t\t{ once: true }\n\t\t\t);\n\t\t}\n\t} else {\n\t\tresolve();\n\t}\n\n\treturn promise;\n});\n\nexport const unloaded = callOnce(async function unloaded({ signal } = {}) {\n\tconst { promise, resolve } = getDeferred();\n\tlisten(globalThis, 'unload', resolve, { signal, once: true, capture: true });\n\treturn promise;\n});\n\nexport const beforeUnload = callOnce(async function beforeUnload({ signal } = {}) {\n\tconst { promise, resolve } = getDeferred({ signal });\n\tlisten(globalThis, 'beforeunload', resolve, { signal, once: true, capture: true });\n\treturn promise;\n});\n\nexport const beforeInstallPrompt = callOnce(async function({ signal } = {}) {\n\tconst { promise, resolve, reject } = getDeferred();\n\n\tif (signal instanceof AbortSignal && signal.aborted) {\n\t\treject(signal.reason);\n\t} else if ('onbeforeinstallprompt' in globalThis) {\n\t\tlisten(globalThis, 'beforeinstallprompt', resolve, { once: true, capture: true, signal });\n\n\t\tif (signal instanceof AbortSignal) {\n\t\t\tlisten(signal, 'abort', ({ reason }) => reject(reason), { once: true });\n\t\t}\n\t}\n\n\treturn await promise;\n});\n\nexport async function whenPageVisible({ signal } = {}) {\n\tconst { promise, resolve } = getDeferred({ signal });\n\n\tif (document.visibilityState === 'visible') {\n\t\tresolve();\n\t} else {\n\t\tlisten(document, 'visibilitychange', () => resolve(), { once: true, signal });\n\t}\n\n\treturn promise;\n}\n\nexport async function whenPageHidden({ signal } = {}) {\n\tconst { promise, resolve } = getDeferred({ signal });\n\n\tif (document.visibilityState === 'hidden') {\n\t\tresolve();\n\t} else {\n\t\tlisten(document, 'visibilitychange', () => resolve(), { once: true, signal });\n\t}\n\n\treturn promise;\n}\n\nexport function parse(text, {\n\ttype = HTML,\n\tasFrag = true,\n\tsanitizer,\n\tpolicy = 'trustedTypes' in globalThis ? globalThis.trustedTypes.defaultPolicy : undefined,\n} = {}) {\n\tconst parser = new DOMParser();\n\n\tif (asFrag) {\n\t\treturn parseAsFragment(text, { sanitizer, policy });\n\t} else if (isTrustPolicy(policy) && ! isHTML(text)) {\n\t\treturn parser.parseFromString(policy.createHTML(text), type);\n\t} else {\n\t\treturn parser.parseFromString(text, type);\n\t}\n}\n\nexport function documentToFragment(doc, { sanitizer } = {}) {\n\tconst clone = doc.cloneNode(true);\n\tconst frag = document.createDocumentFragment();\n\tfrag.append(...clone.head.childNodes, ...clone.body.childNodes);\n\n\treturn typeof sanitizer !== 'undefined' && sanitizer.sanitize instanceof Function\n\t\t? sanitizer.sanitize(frag) : frag;\n}\n\nexport function parseAsFragment(text, {\n\tsanitizer,\n\tpolicy = 'trustedTypes' in globalThis ? globalThis.trustedTypes.defaultPolicy : undefined,\n} = {}) {\n\tconst tmp = document.createElement('template');\n\n\tif (isTrustPolicy(policy) && ! isHTML(text)) {\n\t\ttmp.innerHTML = policy.createHTML(text);\n\t} else {\n\t\ttmp.innerHTML = text;\n\t}\n\n\treturn typeof sanitizer !== 'undefined' && sanitizer.sanitize instanceof Function\n\t\t? sanitizer.sanitize(tmp.content)\n\t\t: tmp.content;\n}\n\nexport function animate(what, keyframes, opts = { duration: 400, base: document.body }) {\n\tif (opts.signal instanceof AbortSignal && opts.signal.aborted) {\n\t\tthrow opts.signal.reason;\n\t} else if (! (Element.prototype.animate instanceof Function)) {\n\t\tthrow new DOMException('Animations not supported');\n\t} else {\n\t\tif (Number.isInteger(opts)) {\n\t\t\topts = { duration: opts };\n\t\t}\n\n\t\tconst animations = query(what, opts.base).map(item => item.animate(keyframes, opts));\n\n\t\tif (opts.signal instanceof AbortSignal) {\n\t\t\topts.signal.addEventListener('abort', () => animations.forEach(anim => anim.cancel()), { once: true });\n\t\t}\n\n\t\tif (opts.resolve instanceof Function) {\n\t\t\tPromise.allSettled(animations.map(anim => anim.finished))\n\t\t\t\t.then(proms => opts.resolve(proms.group(({ status }) => status)));\n\t\t}\n\n\t\treturn animations;\n\t}\n}\n\nexport function intersect(what, callback, { root, rootMargin, signal, threshold } = {}) {\n\tif (signal instanceof AbortSignal && signal.aborted) {\n\t\tthrow signal.reason;\n\t} else if (! ('IntersectionObserver' in globalThis)) {\n\t\tthrow new DOMException('IntersectionObserver not supported');\n\t} else {\n\t\tconst observer = new IntersectionObserver((entries, observer) => {\n\t\t\tentries.forEach((entry, index) => callback.apply(null, [entry, observer, index]));\n\t\t}, { root, rootMargin, threshold });\n\n\t\teach(what, item => observer.observe(item));\n\n\t\tif (signal instanceof AbortSignal) {\n\t\t\tsignalAborted(signal).finally(() => observer.disconnect());\n\t\t}\n\n\t\treturn observer;\n\t}\n}\n\nexport function mutate(what, callback, options = {}) {\n\tif ('MutationObserver' in globalThis) {\n\t\tconst observer = new MutationObserver((records, observer) => {\n\t\t\trecords.forEach((record, index) => callback.apply(null, [record, observer, index]));\n\t\t});\n\n\t\teach(what, item => observer.observe(item, options));\n\n\t\tif (options.signal instanceof AbortSignal) {\n\t\t\tsignalAborted(options.signal).finally(() => observer.disconnect());\n\t\t}\n\n\t\treturn observer;\n\t} else {\n\t\tthrow new Error('MutationObserver not supported');\n\t}\n}\n\nexport function stripComments(node) {\n\tif (! (node instanceof Node)) {\n\t\tthrow new TypeError('Cannot strip comments from non-node');\n\t} else {\n\t\tswitch(node.nodeType) {\n\t\t\tcase Node.ELEMENT_NODE:\n\t\t\tcase Node.DOCUMENT_NODE:\n\t\t\tcase Node.DOCUMENT_FRAGMENT_NODE:\n\t\t\t\tif (node.hasChildNodes()) {\n\t\t\t\t\t[...node.childNodes].forEach(stripComments);\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase Node.COMMENT_NODE:\n\t\t\t\tnode.remove();\n\t\t\t\tbreak;\n\t\t}\n\t}\n}\n\nexport function supportsElement(...tags) {\n\treturn ! tags.some(tag => document.createElement(tag) instanceof HTMLUnknownElement);\n}\n\nexport function createTable(data, { caption, header, footer } = {}) {\n\tconst table = document.createElement('table');\n\tif (Array.isArray(data)) {\n\t\tdata.forEach(row => {\n\t\t\tif (Array.isArray(row)) {\n\t\t\t\tconst tr = table.insertRow();\n\t\t\t\trow.forEach(cell => tr.insertCell().textContent = cell);\n\t\t\t}\n\t\t});\n\t}\n\n\tif (Array.isArray(header)) {\n\t\tconst tHead = table.createTHead();\n\t\tconst row = tHead.insertRow();\n\t\trow.append(...header.map(cell => {\n\t\t\tconst th = document.createElement('th');\n\t\t\tth.scope = 'col';\n\t\t\tth.textContent = cell;\n\t\t\treturn th;\n\t\t}));\n\t}\n\n\tif (Array.isArray(footer)) {\n\t\tconst tFoot = table.createTFoot();\n\t\tconst row = tFoot.insertRow();\n\t\trow.append(...footer.map(cell => {\n\t\t\tconst th = document.createElement('th');\n\t\t\tth.textContent = cell;\n\t\t\treturn th;\n\t\t}));\n\t}\n\n\tif (typeof caption === 'string') {\n\t\ttable.createCaption().textContent = caption;\n\t}\n\n\treturn table;\n}\n\nexport { addListener, isAsync, errorToEvent };\n","/**\n * @copyright 2023 Chris Zuber <admin@kernvalley.us>\n */\nimport { when, beforeUnload, unloaded } from './dom.js';\nimport { getDeferred } from './promises.js';\nimport { listen } from './events.js';\nexport const supported =  'AbortController' in window && AbortController.prototype.hasOwnProperty('signal');\n\nexport function throwIfAborted(signal) {\n\tif (signal instanceof AbortController) {\n\t\tsignal.signal.throwIfAborted();\n\t} else if (signal instanceof AbortSignal) {\n\t\tsignal.throwIfAborted();\n\t}\n}\n\nexport function getBeforeUnloadSignal() {\n\tconst controller = new AbortController();\n\tbeforeUnload().then(() => controller.abort());\n\treturn controller.signal;\n}\n\nexport function getUnloadSignal() {\n\tconst controller = new AbortController();\n\tunloaded().then(() => controller.abort());\n\treturn controller.signal;\n}\n\nexport function isAborted(signal) {\n\tif (signal instanceof AbortController) {\n\t\treturn signal.signal.aborted;\n\t} else {\n\t\treturn signal instanceof AbortSignal && signal.aborted;\n\t}\n}\n\nexport async function signalAborted(signal) {\n\tconst { reject, promise } = getDeferred();\n\n\tif (signal instanceof AbortController) {\n\t\treturn signalAborted(signal.signal);\n\t} else if (! (signal instanceof EventTarget)) {\n\t\treject(new DOMException('Not an AbortSignal'));\n\t} else if (signal.aborted) {\n\t\treject(signal.reason);\n\t} else {\n\t\tsignal.addEventListener('abort', ({ target }) => reject(target.reason),{ once: true });\n\t}\n\n\treturn promise;\n}\n\nexport function abortButtonController(button, { reason } = {}) {\n\tif (! (button instanceof HTMLButtonElement)) {\n\t\tthrow new TypeError('Not a <button>');\n\t}\n\n\tconst controller = new AbortController();\n\tbutton.disabled = false;\n\n\tlisten(button, 'click', () => controller.abort(reason), { signal: controller.signal, once: true });\n\tlisten(controller.signal, 'abort', () => button.disabled = true, { once: true });\n\n\treturn controller;\n}\n\n/**\n * @deprecated\n */\nexport function abortTimeoutController(timeout, { reason } = {}) {\n\tconsole.warn('`abortTimeoutController()` is deprecated. Use `AbortSignal.timeout()` instead.');\n\tconst controller = new AbortController();\n\n\tabortableTimeout(() => controller.abort(reason), timeout, { signal: controller.signal });\n\n\treturn controller;\n}\n\n/**\n * @deprecated\n */\nexport function abortTimeoutSignal(timeout, { reason } = {}) {\n\treturn abortTimeoutController(timeout, { reason }).signal;\n}\n\nexport function abortEventController(what, events, { passive, capture, reason } = {}) {\n\tconst controller = new AbortController();\n\n\twhen(what, events, { signal: controller.signal, capture, passive, once: true }).then(() => {\n\t\tif (! controller.signal.aborted) {\n\t\t\tcontroller.abort(reason);\n\t\t}\n\t});\n\n\treturn controller;\n}\n\nexport function abortableTimeout(callback, ms, { signal } = {}) {\n\tconst id = setTimeout(() => callback(), ms);\n\n\tif (signal instanceof AbortSignal) {\n\t\tsignalAborted(signal).finally(() => clearTimeout(id));\n\t}\n\n\treturn id;\n}\n\nexport function abortableInterval(callback, ms, { signal } = {}) {\n\tconst id = setInterval(() => callback(), ms);\n\n\tif (signal instanceof AbortSignal) {\n\t\tsignalAborted(signal).finally(() => clearInterval(id));\n\t}\n\n\treturn id;\n}\n\nexport function abortableAnimationFrame(callback, { signal } = {}) {\n\tconst id = requestAnimationFrame(callback);\n\n\tif (signal instanceof AbortSignal) {\n\t\tsignalAborted(signal).finally(() => cancelAnimationFrame(id));\n\t}\n\n\treturn id;\n}\n\nexport function abortableIdleCallback(callback, { signal, timeout } = {}) {\n\tconst id = requestIdleCallback(callback);\n\n\tif (signal instanceof AbortSignal) {\n\t\tsignalAborted(signal).finally(() => cancelIdleCallback(id, { timeout }));\n\t}\n\n\treturn id;\n}\n\nexport function signalRaceController(...signals) {\n\tconst controller = new AbortController();\n\tconst signal = anyAbortedSignal(...signals);\n\n\tsignal.addEventListener('abort', ({ target }) => {\n\t\tcontroller.abort(target.reason || new DOMException('Operation aborted.'));\n\t}, { signal: controller.signal });\n\n\treturn controller;\n}\n\nexport function signalAllController(...signals) {\n\tconst controller = new AbortController();\n\n\tPromise.all(signals.map(signal => signalAborted(signal))).finally(() => controller.abort());\n\n\treturn controller;\n}\n\nexport function anyAbortedSignal(...signals) {\n\tif (AbortSignal.any instanceof Function) {\n\t\treturn AbortSignal.any(signals);\n\t} else {\n\t\tconst controller = new AbortController();\n\n\t\tfor (const signal of signals) {\n\t\t\tif (! (signal instanceof AbortSignal)) {\n\t\t\t\tconst err = new TypeError('`signal` is not an `AbortSignal`');\n\t\t\t\tcontroller.abort(err);\n\t\t\t\tthrow err;\n\t\t\t} else if (signal.aborted) {\n\t\t\t\tcontroller.abort(signal.reason || new DOMException('Operation aborted.'));\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\tsignal.addEventListener('abort', ({ target }) => {\n\t\t\t\t\tcontroller.abort(target.reason || new DOMException('Operation aborted.'));\n\t\t\t\t}, { signal: controller.signal });\n\t\t\t}\n\t\t}\n\n\t\treturn controller.signal;\n\t}\n}\n","/**\n * @copyright 2023 Chris Zuber <admin@kernvalley.us>\n */\nimport { signalAborted } from './abort.js';\nexport const infinitPromise = new Promise(() => {});\n\nexport async function locksSupported() {\n\tif ('locks' in navigator) {\n\t\ttry {\n\t\t\treturn await navigator.locks.request('lock-test', () => true);\n\t\t} catch(err) {\n\t\t\treturn false;\n\t\t}\n\t}\n}\n\nexport function isAsyncFunction(what) {\n\treturn what instanceof Function && what.constructor.name === 'AsyncFunction';\n}\n\nexport function isAsync(what) {\n\treturn isAsyncFunction(what) || what instanceof  Promise;\n}\n\nexport function getDeferred({ signal } = {}) {\n\tconst deferred = {};\n\n\tdeferred.promise = new Promise((resolve, reject) => {\n\t\tdeferred.resolve = resolve;\n\t\tdeferred.reject = reject;\n\t});\n\n\tif (signal instanceof EventTarget && signal.throwIfAborted instanceof Function) {\n\t\tif (signal.aborted) {\n\t\t\tdeferred.reject(signal.reason);\n\t\t} else {\n\t\t\tsignal.addEventListener('abort', ({ target }) => deferred.reject(target.reason), { once: true });\n\t\t}\n\t}\n\n\treturn Object.seal(deferred);\n}\n\nexport async function callAsAsync(callback, args = [], { thisArg = globalThis, signal } = {}) {\n\tconst { promise, resolve, reject } = getDeferred({ signal });\n\n\tif (! (callback instanceof Function)) {\n\t\treject(new TypeError('`callAsAsync` expects callback to be a function'));\n\t} else if (! Array.isArray(args)) {\n\t\treject(new TypeError('`args` must be an array'));\n\t} else if (signal instanceof AbortSignal && signal.aborted) {\n\t\treject(signal.reason);\n\t} else if (isAsyncFunction(callback)) {\n\t\tcallback.call(thisArg, args).then(resolve).catch(reject);\n\t} else {\n\t\tqueueMicrotask(() => {\n\t\t\ttry {\n\t\t\t\tresolve(callback.call(thisArg, args));\n\t\t\t} catch(err) {\n\t\t\t\treject(err);\n\t\t\t}\n\t\t});\n\t}\n\n\treturn await promise;\n}\n\nexport function createDeferredCallback(callback, { signal, thisArg } = {}) {\n\tconst { promise, resolve } = getDeferred({ signal });\n\tconst retPromise = promise.then(() => callAsAsync(callback, [], { signal, thisArg }));\n\n\treturn async () => {\n\t\tresolve();\n\t\treturn await retPromise;\n\t};\n}\n\nexport async function lock(name, callback, {\n\tthisArg = globalThis,\n\targs = [],\n\tmode = 'exclusive',\n\tifAvailable = false,\n\tsteal = false,\n\tallowFallback = true,\n\tsignal,\n} = {}) {\n\tif ((! allowFallback) || await locksSupported()) {\n\t\treturn await navigator.locks.request(name, { mode, ifAvailable, steal, signal }, async lock => {\n\t\t\tif (lock) {\n\t\t\t\treturn await callAsAsync(callback, [lock, ...args], { thisArg, signal });\n\t\t\t}\n\t\t});\n\t} else {\n\t\treturn await callAsAsync(callback, [null, ...args], { signal, thisArg });\n\t}\n}\n\nexport async function onAnimationFrame(callback, {\n\tthisArg = globalThis,\n\targs = [],\n\tsignal,\n} = {}) {\n\tconst { promise, resolve, reject } = getDeferred({ signal });\n\tconst id = requestAnimationFrame(hrts => callAsAsync(callback, [hrts, ...args], { signal, thisArg }).then(resolve, reject));\n\n\tif (signal instanceof AbortSignal) {\n\t\tsignalAborted(signal).finally(() => cancelAnimationFrame(id));\n\t}\n\n\treturn await promise;\n}\n\nexport async function onIdle(callback, {\n\ttimeout,\n\tthisArg = globalThis,\n\targs = [],\n\tsignal,\n} = {}) {\n\tconst { promise, resolve, reject } = getDeferred({ signal });\n\tconst id = requestIdleCallback(hrts => callAsAsync(callback, [hrts, ...args], { thisArg, signal }).then(resolve, reject), { timeout });\n\n\tif (signal instanceof AbortSignal) {\n\t\tsignalAborted(signal).finally(() => cancelIdleCallback(id));\n\t}\n\n\treturn await promise;\n}\n\nexport async function onTimeout(callback, {\n\ttimeout = 0,\n\tthisArg = globalThis,\n\targs = [],\n\tsignal,\n} = {}) {\n\tconst { resolve, reject, promise } = getDeferred({ signal });\n\n\tif (Number.isSafeInteger(timeout) && timeout >= 0) {\n\t\tconst id = setTimeout(() => {\n\t\t\tcallAsAsync(callback, args, { signal, thisArg }).then(resolve).catch(reject);\n\t\t}, timeout);\n\n\t\tif (signal instanceof AbortSignal) {\n\t\t\tsignalAborted(signal).finally(() => clearTimeout(id));\n\t\t}\n\t} else {\n\t\treject(new TypeError('`timeout` must be a positive intege'));\n\t}\n\n\treturn await promise;\n}\n\nexport async function sleep(timeout, { signal } = {}) {\n\tconst { resolve, promise } = getDeferred({ signal });\n\tonTimeout(() => resolve(performance.now()), { signal, timeout })\n\t\t.catch(() => resolve(performance.now()));\n\treturn await promise;\n}\n","/**\n * @copyright 2023 Chris Zuber <admin@kernvalley.us>\n */\nimport { randomInt } from './math.js';\nimport { isAsyncFunction, getDeferred } from './promises.js';\nimport { isScriptURL, isTrustPolicy } from './trust.js';\n\nconst funcs = new WeakMap();\n\nexport function isStrictMode() {\n\t// Probably always true\n\treturn typeof this === 'undefined';\n}\n\nexport const autoServiceWorkerRegistration = callOnce(async ({\n\tpolicy = 'trustedTypes' in globalThis ? trustedTypes.defaultPolicy : null,\n} = {}) => {\n\tif ('serviceWorker' in navigator && 'serviceWorker' in document.documentElement.dataset) {\n\t\tconst { serviceWorker, scope = '/', updateViaCache } = document.documentElement.dataset;\n\n\t\ttry {\n\t\t\tif (isTrustPolicy(policy)) {\n\t\t\t\tawait registerServiceWorker(policy.createScriptURL(serviceWorker), { scope, updateViaCache });\n\t\t\t} else {\n\t\t\t\tawait registerServiceWorker(serviceWorker, { scope, updateViaCache });\n\t\t\t}\n\n\t\t\tawait reloadOnUpdate();\n\t\t} catch(err) {\n\t\t\tconsole.error(err);\n\t\t}\n\t}\n});\n\nexport async function reloadOnUpdate() {\n\tif ('serviceWorker' in navigator && 'reloadOnUpdate' in document.documentElement.dataset) {\n\t\tconst reg = await navigator.serviceWorker.ready;\n\n\t\treg.addEventListener('updatefound', async ({ target }) => {\n\t\t\ttarget.update();\n\n\t\t\tconst HTMLNotificationElement = await customElements.whenDefined('html-notification');\n\t\t\tconst notification = new HTMLNotificationElement('Update available', {\n\t\t\t\tbody: 'App updated in background. Would you like to reload to see updates?',\n\t\t\t\trequireInteraction: true,\n\t\t\t\tactions: [{\n\t\t\t\t\ttitle: 'Reload',\n\t\t\t\t\taction: 'reload',\n\t\t\t\t}, {\n\t\t\t\t\ttitle: 'Dismiss',\n\t\t\t\t\taction: 'dismiss',\n\t\t\t\t}]\n\t\t\t});\n\n\t\t\tnotification.addEventListener('notificationclick', ({ target, action }) => {\n\t\t\t\tswitch(action) {\n\t\t\t\t\tcase 'dismiss':\n\t\t\t\t\t\ttarget.close();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'reload':\n\t\t\t\t\t\ttarget.close();\n\t\t\t\t\t\tlocation.reload();\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n}\n\nexport async function registerServiceWorker(source, {\n\tscope,\n\tpolicy = 'trustedTypes' in globalThis ? trustedTypes.defaultPolicy : null,\n\ttype = 'classic',\n\tupdateViaCache = 'none',\n} = {}) {\n\tconst { resolve, reject, promise } = getDeferred();\n\n\tif (! ('serviceWorker' in navigator && navigator.serviceWorker.register instanceof Function)) {\n\t\treject(new DOMException('Service worker not supported'));\n\t} else if (! (typeof source === 'string' || isScriptURL(source) || source instanceof URL)) {\n\t\treject(new TypeError('Invalid Service worker registration source'));\n\t} else if (! isScriptURL(source) && isTrustPolicy(policy)) {\n\t\tnavigator.serviceWorker.register(\n\t\t\tpolicy.createScriptURL(source),\n\t\t\t{ scope, type, updateViaCache }\n\t\t).then(resolve).catch(reject);\n\t} else {\n\t\tnavigator.serviceWorker.register(source, { scope, type, updateViaCache })\n\t\t\t.then(resolve).catch(reject);\n\t}\n\n\treturn await promise;\n}\n\nexport function getURLResolver({ base = document.baseURI, path = './' } = {}) {\n\tconst url = new URL(path, base);\n\n\treturn path => new URL(path, url).href;\n}\n\nexport function isObject(thing) {\n\treturn typeof thing === 'object' && ! Object.is(thing, null) && ! Array.isArray(thing);\n}\n\nexport function isNull(val) {\n\treturn Object.is(val, null);\n}\n\nexport function isUndefined(val) {\n\treturn typeof val === 'undefined';\n}\n\nexport function isIterable(thing) {\n\treturn Array.isArray(thing) || (isObject(thing) && thing[Symbol.iterator] instanceof Function);\n}\n\nexport function isNullish(val) {\n\tswitch (typeof val) {\n\t\tcase 'undefined':\n\t\t\treturn true;\n\n\t\tcase 'object':\n\t\t\tif (Object.is(val, null)) {\n\t\t\t\treturn true;\n\t\t\t} else if (Array.isArray(val)) {\n\t\t\t\treturn val.length === 0;\n\t\t\t} else if (val instanceof Date) {\n\t\t\t\treturn Number.isNaN(val.getTime());\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\tcase 'number':\n\t\t\treturn Number.isNaN(val);\n\n\t\tcase 'string':\n\t\t\treturn val.length === 0;\n\n\t\tdefault:\n\t\t\treturn false;\n\t}\n}\n\nexport function getType(thing) {\n\tswitch (typeof thing) {\n\t\tcase 'undefined':\n\t\t\treturn 'Undefined';\n\n\t\tcase 'function':\n\t\t\tif ('prototype' in thing) {\n\t\t\t\treturn getType(thing.prototype);\n\t\t\t} else if ('constructor' in thing) {\n\t\t\t\treturn thing.constructor.name;\n\t\t\t} else {\n\t\t\t\treturn 'Function';\n\t\t\t}\n\n\t\tcase 'object':\n\t\t\tif (Object.is(thing, null)) {\n\t\t\t\treturn 'Null';\n\t\t\t} else if ('constructor' in thing) {\n\t\t\t\treturn thing.constructor.name;\n\t\t\t} else if (Symbol.toStringTag in thing) {\n\t\t\t\treturn thing[Symbol.toStringTag];\n\t\t\t} else if ('prototype' in thing) {\n\t\t\t\treturn  getType(thing.prototype);\n\t\t\t} else {\n\t\t\t\tconsole.log(thing);\n\t\t\t\treturn 'Unknown Object';\n\t\t\t}\n\n\t\tcase 'string':\n\t\t\treturn 'String';\n\n\t\tcase 'number':\n\t\t\treturn Number.isNaN(thing) ? 'NaN' : 'Number';\n\n\t\tcase 'bigint':\n\t\t\treturn 'BigInt';\n\n\t\tcase 'boolean':\n\t\t\treturn 'Boolean';\n\n\t\tcase 'symbol':\n\t\t\treturn 'Symbol';\n\n\t\tdefault:\n\t\t\treturn 'Unknown';\n\t}\n}\n\nexport function isA(thing, expectedType) {\n\tif (typeof expectedType === 'string') {\n\t\treturn getType(thing) === expectedType;\n\t} else if (isObject(expectedType) && 'constructor' in expectedType) {\n\t\treturn isA(thing, expectedType.constructor.name);\n\t} else {\n\t\tthrow new TypeError('Invalid argument for `expectedType`');\n\t}\n}\n\nexport function sameType(thing1, thing2) {\n\treturn isA(thing1, getType(thing2));\n}\n\nexport function deepEquals(thing1, thing2, { depth = 5 } = {}) {\n\tconst type1 = getType(thing1);\n\tconst type2 = getType(thing2);\n\n\tif (! Number.isSafeInteger(depth)) {\n\t\tthrow new TypeError('`depth` must be an integer');\n\t} else if (type1 !== type2) {\n\t\treturn false;\n\t} else if (thing1 === thing2) {\n\t\treturn true;\n\t} else {\n\t\tdepth--;\n\t\tswitch(type1) {\n\t\t\tcase 'NaN':\n\t\t\t\t// Since NaN !== NaN\n\t\t\t\treturn true;\n\n\t\t\tcase 'BigInt':\n\t\t\tcase 'Number':\n\t\t\tcase 'String':\n\t\t\tcase 'Symbol':\n\t\t\tcase 'Boolean':\n\t\t\t\t// Already know not equal\n\t\t\t\treturn false;\n\n\t\t\tcase 'Object':\n\t\t\t\treturn depth < 0 || deepEquals(Object.entries(thing1), Object.entries(thing2), { depth });\n\n\t\t\tcase 'Array':\n\t\t\t\treturn depth < 0 || (\n\t\t\t\t\tthing1.length === thing2.length\n\t\t\t\t\t&& thing1.every((thing, i) => deepEquals(thing, thing2[i], { depth }))\n\t\t\t\t);\n\n\t\t\tcase 'Map':\n\t\t\tcase 'Set':\n\t\t\t\treturn depth < 0 || deepEquals([...thing1], [...thing2], { depth });\n\n\t\t\tcase 'URL':\n\t\t\t\treturn thing1.href === thing2.href;\n\n\t\t\tdefault:\n\t\t\t\tif (thing1 instanceof Node) {\n\t\t\t\t\treturn thing1.isSameNode(thing2);\n\t\t\t\t} else if (Symbol.iterator in thing1) {\n\t\t\t\t\treturn depth < 0 || deepEquals([...thing1], [...thing2], { depth });\n\t\t\t\t} else {\n\t\t\t\t\t// Since already not `===`\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t}\n\t}\n}\n\n/* global define */\nexport function amd(name, factory, requires = {}) {\n\tif (typeof define === 'function' && define.amd) {\n\t\t// AMD. Register as an anonymous module.\n\t\ttry {\n\t\t\tdefine(name, requires, factory);\n\t\t\treturn true;\n\t\t} catch(err) {\n\t\t\tconsole.error(err);\n\t\t\treturn false;\n\t\t}\n\t} else {\n\t\treturn false;\n\t}\n}\n\nexport function errorToEvent(error, type = 'error') {\n\tif (error instanceof Error) {\n\t\tconst { message, name, fileName: filename, lineNumber: lineno, columnNumber: colno } = error;\n\t\treturn new ErrorEvent(type, { error, message: `${name}: ${message}`, filename, lineno, colno });\n\t} else {\n\t\tthrow new TypeError('`errorToEvent()` only accepts Errors');\n\t}\n}\n\nexport function callOnce(callback, thisArg) {\n\tif (callback.once instanceof Function) {\n\t\treturn callback.once(thisArg);\n\t} else {\n\t\treturn function(...args) {\n\t\t\tif (funcs.has(callback)) {\n\t\t\t\treturn funcs.get(callback);\n\t\t\t} else if (isAsyncFunction(callback)) {\n\t\t\t\tconst retVal = callback.apply(thisArg || this, args).catch(err => {\n\t\t\t\t\tfuncs.delete(callback);\n\t\t\t\t\tthrow err;\n\t\t\t\t});\n\n\t\t\t\tfuncs.set(callback, retVal);\n\t\t\t\treturn retVal;\n\t\t\t} else if (callback instanceof Function) {\n\t\t\t\tconst retVal = callback.apply(thisArg || this, args);\n\t\t\t\tfuncs.set(callback, retVal);\n\t\t\t\treturn retVal;\n\t\t\t}\n\t\t};\n\t}\n}\n\nexport function setURLParams(forURL, params) {\n\tconst url = new URL(forURL, document.baseURI);\n\n\tif (params instanceof HTMLFormElement) {\n\t\treturn setURLParams(url, new FormData(params));\n\t} else if (params instanceof FormData) {\n\t\treturn setURLParams(url, Object.fromEntries(params));\n\t} else if (params instanceof URLSearchParams) {\n\t\treturn setURLParams(url, Object.fromEntries(params));\n\t} else if (Array.isArray(params) || typeof params === 'string') {\n\t\treturn setURLParams(url, new URLSearchParams(params));\n\t} else if (isObject(params)) {\n\t\tObject.entries(params).forEach(([k, v]) => {\n\t\t\tif (typeof v === 'string' || (typeof v === 'number' && ! Number.isNaN(v))) {\n\t\t\t\turl.searchParams.set(k, v);\n\t\t\t} else if (typeof v === 'boolean') {\n\t\t\t\tif (v) {\n\t\t\t\t\turl.searchParams.set(k, '');\n\t\t\t\t} else {\n\t\t\t\t\turl.searchParams.delete(k);\n\t\t\t\t}\n\t\t\t} else if (! isNullish(v)) {\n\t\t\t\turl.searchParams.set(k, v.toString());\n\t\t\t}\n\t\t});\n\t}\n\n\treturn url;\n}\n\nexport function setUTMParams(url, {\n\tsource: utm_source,\n\tmedium: utm_medium = 'referral',\n\tcontent: utm_content,\n\tcampaign: utm_campaign,\n\tterm: utm_term,\n} = {}) {\n\tif (isNullish(url)) {\n\t\treturn null;\n\t} else if (! (url instanceof URL)) {\n\t\treturn setUTMParams(new URL(url, document.baseURI), {\n\t\t\tsource: utm_source,\n\t\t\tmedium: utm_medium,\n\t\t\tcontent: utm_content,\n\t\t\tcampaign: utm_campaign,\n\t\t\tterm: utm_term,\n\t\t});\n\t} else if (typeof utm_source !== 'string') {\n\t\treturn url;\n\t} else {\n\t\treturn setURLParams(url, { utm_source, utm_medium, utm_content, utm_campaign, utm_term });\n\t}\n}\n\nexport function debounce(callback, { delay = 17, thisArg } = {}) {\n\tif (! (callback instanceof Function)) {\n\t\tthrow new TypeError('Callback must be a function');\n\t} else if (! Number.isFinite(delay) || delay < 0) {\n\t\tthrow new TypeError('Timeout must be a positive intiger');\n\t} else {\n\t\tlet to;\n\t\treturn function(...args) {\n\t\t\tif (typeof to === 'number') {\n\t\t\t\tclearTimeout(to);\n\t\t\t\tto = null;\n\t\t\t}\n\t\t\tto = setTimeout((...args) => callback.apply(thisArg, args), delay, ...args);\n\t\t};\n\t}\n}\n\nexport function throttle(callback, { delay = 17, thisArg } = {}) {\n\tif (! (callback instanceof Function)) {\n\t\tthrow new TypeError('Callback must be a function');\n\t} else if (! Number.isFinite(delay) || delay < 0) {\n\t\tthrow new TypeError('Timeout must be a positive intiger');\n\t} else {\n\t\tlet to;\n\t\treturn function(...args) {\n\t\t\tif (typeof to !== 'number') {\n\t\t\t\tto = setTimeout(() => to = null, delay);\n\t\t\t\tcallback.apply(thisArg, args);\n\t\t\t}\n\t\t};\n\t}\n}\n\nexport function random(arr) {\n\tif (Array.isArray(arr) && arr.length !== 0) {\n\t\treturn arr[randomInt(0, arr.length)];\n\t}\n}\n\nexport const toSpinalCase = str => str.replace(/[A-Z]/g, (m, i) => i === 0\n\t? m.toLowerCase()\n\t: `-${m.toLowerCase()}`);\n\nexport const toCamelCase = str => str.replace(/-[a-z\\d]/g, m => m.substr(1).toUpperCase());\n\nexport const ucFirst = str => str.substr(0, 1).toUpperCase() + str.substr(1);\n","/**\n * @copyright 2023 Chris Zuber <admin@kernvalley.us>\n */\nimport { clamp, between } from './math.js';\nimport { isObject, isNullish } from './utility.js';\nimport { toHexColor, parseHexColor } from './color-utils.js';\nimport { setAttr, isScriptURL, isTrustedType } from './trust.js';\nimport { COLOR } from './patterns.js';\n\nexport function getAttrs(el) {\n\tif (typeof el === 'string') {\n\t\treturn getAttrs(document.querySelector(el));\n\t} else if (el instanceof Element) {\n\t\treturn Object.fromEntries([...el.attributes].map(({ name, value }) => [name, value]));\n\t} else {\n\t\tthrow new TypeError(`Expected an element or selector but got a ${typeof el}`);\n\t}\n}\n\nexport function aria(el, props = {}) {\n\tif (! (el instanceof Element)) {\n\t\tthrow new TypeError('`el` must be an Element');\n\t} else {\n\t\tObject.entries(props).forEach(([prop, val]) => {\n\t\t\tif (prop !== 'role') {\n\t\t\t\tprop = `aria-${prop.toLowerCase()}`;\n\t\t\t}\n\n\t\t\tif (isNullish(val)) {\n\t\t\t\tel.removeAttribute(prop);\n\t\t\t} else {\n\t\t\t\tel.setAttribute(prop, val);\n\t\t\t}\n\t\t});\n\t}\n}\n\nexport function data(el, props = {}) {\n\tif (! (el instanceof Element)) {\n\t\tthrow new TypeError('el must be an Element');\n\t} if (! isObject(props)) {\n\t\tthrow new TypeError('props must be an object');\n\t} else {\n\t\tObject.entries(props).forEach(([p, v]) => {\n\t\t\tswitch (typeof v) {\n\t\t\t\tcase 'string':\n\t\t\t\tcase 'number':\n\t\t\t\t\tel.dataset[p] = v.toString();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'boolean':\n\t\t\t\t\tif (v) {\n\t\t\t\t\t\tel.dataset[p] = '';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdelete el.dataset[p];\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'undefined':\n\t\t\t\t\tdelete el.dataset[p];\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'object':\n\t\t\t\t\tif (Object.is(v, null)) {\n\t\t\t\t\t\tdelete el.dataset[p];\n\t\t\t\t\t} else if (v instanceof Date) {\n\t\t\t\t\t\tel.dataset[p] = v.toISOString();\n\t\t\t\t\t} else if (v instanceof URL) {\n\t\t\t\t\t\tel.dataset[p] = v.href;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tel.dataset[p] = JSON.stringify(v);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tthrow new TypeError(`Unable to handle type: ${typeof v}`);\n\t\t\t}\n\t\t});\n\t}\n}\n\nexport function css(el, props = {}, { priority } = {}) {\n\tif (! (el instanceof Element)) {\n\t\tthrow new TypeError('el must be an Element');\n\t} if (! isObject(props)) {\n\t\tthrow new TypeError('props must be an object');\n\t} else {\n\t\tObject.entries(props).forEach(([p, v]) => {\n\t\t\tif (typeof v === 'string' || typeof v === 'number') {\n\t\t\t\tel.style.setProperty(p, v, priority);\n\t\t\t} else if (v instanceof URL) {\n\t\t\t\tel.type.setProperty(p, v.href, priority);\n\t\t\t} else if (typeof v === 'object' && ! Object.is(v, null) && v.toString instanceof Function) {\n\t\t\t\tel.style.setProperty(p, v.toString(), priority);\n\t\t\t} else {\n\t\t\t\tel.style.removeProperty(p);\n\t\t\t}\n\t\t});\n\t}\n}\n\nexport function attr(el, props = {}, {\n\tnamespace: elementNs = null,\n\tpolicy,\n} = {}) {\n\tif (! (el instanceof Element)) {\n\t\tthrow new TypeError('el must be an Element');\n\t} if (! isObject(props)) {\n\t\tthrow new TypeError('props must be an object');\n\t} else {\n\t\tObject.entries(props).forEach(([p, v]) => {\n\t\t\tif (typeof v === 'string' || typeof v === 'number') {\n\t\t\t\tsetAttr(el, p, v, { policy, elementNs });\n\t\t\t} else if ('trustedTypes' in globalThis && isTrustedType(v)) {\n\t\t\t\tif (v.toString().length === 0) {\n\t\t\t\t\tel.removeAttribute(p);\n\t\t\t\t} else {\n\t\t\t\t\tsetAttr(el, p, v, { policy, elementNs });\n\t\t\t\t}\n\t\t\t} else if (typeof v === 'boolean') {\n\t\t\t\tif (typeof namespace === 'string') {\n\t\t\t\t\tv ? el.setAttributeNS(elementNs, p, '') : el.removeAttributeNS(elementNs, p);\n\t\t\t\t} else {\n\t\t\t\t\tel.toggleAttribute(p, v);\n\t\t\t\t}\n\t\t\t} else if (v instanceof Date) {\n\t\t\t\tsetAttr(el, p, v.toISOString(), { policy, elementNs });\n\t\t\t} else if (v instanceof URL) {\n\t\t\t\tsetAttr(el, p, v.href, { policy, elementNs });\n\t\t\t} else if (typeof v === 'undefined' || v === null) {\n\t\t\t\tif (typeof namespace === 'string') {\n\t\t\t\t\tel.removeAttributeNS(elementNs, p);\n\t\t\t\t} else {\n\t\t\t\t\tel.removeAttribute(p);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tsetAttr(el, p, JSON.stringify(v), { policy, elementNs });\n\t\t\t}\n\t\t});\n\t}\n}\n\nexport function getBool(el, attr) {\n\treturn el.hasAttribute(attr);\n}\n\nexport function setBool(el, attr, val) {\n\tel.toggleAttribute(attr, val);\n}\n\nexport function getInt(el, attr, {\n\tfallback = NaN,\n\tmin = Number.MIN_SAFE_INTEGER,\n\tmax = Number.MAX_SAFE_INTEGER,\n} = {}) {\n\tif (el.hasAttribute(attr)) {\n\t\tconst val = clamp(min, parseInt(el.getAttribute(attr)), max);\n\t\treturn Number.isNaN(val) ? fallback : val;\n\t} else {\n\t\treturn fallback;\n\t}\n}\n\nexport function setInt(el, attr, val, {\n\tmin = Number.MIN_SAFE_INTEGER,\n\tmax = Number.MAX_SAFE_INTEGER,\n\tpolicy,\n} = {}) {\n\tif (val instanceof Date) {\n\t\tsetAttr(el, attr, val.getTime(), { min, max, policy});\n\t} else if (Number.isInteger(val)) {\n\t\tsetAttr(el, attr, clamp(min, val, max), { policy });\n\t} else if (typeof val === 'string') {\n\t\tsetInt(el, attr, parseInt(val), { min, max });\n\t} else {\n\t\tel.removeAttribute(attr);\n\t}\n}\n\nexport function getFloat(el, attr, {\n\tfallback = NaN,\n\tmin = Number.MIN_SAFE_INTEGER,\n\tmax = Number.MAX_SAFE_INTEGER,\n} = {}) {\n\tif (el.hasAttribute(attr)) {\n\t\tconst val = clamp(min, parseFloat(el.getAttribute(attr)), max);\n\t\treturn Number.isNaN(val) ? fallback : val;\n\t} else {\n\t\treturn fallback;\n\t}\n}\n\nexport function setFloat(el, attr, val, {\n\tmin = Number.MIN_SAFE_INTEGER,\n\tmax = Number.MAX_SAFE_INTEGER,\n\tpolicy,\n} = {}) {\n\tif (typeof val === 'number' && ! Number.isNaN(val)) {\n\t\tsetAttr(el, attr, clamp(min, val, max), { policy });\n\t} else if (typeof val === 'string') {\n\t\tsetFloat(el, attr, parseFloat(val), { min, max });\n\t} else {\n\t\tel.removeAttribute(attr);\n\t}\n}\n\nexport function getString(el, attr, { fallback = null } = {}) {\n\tif (el.hasAttribute(attr)) {\n\t\treturn el.getAttribute(attr) || fallback;\n\t} else {\n\t\treturn fallback;\n\t}\n}\n\nexport function setString(el, attr, val, {\n\tminLength = 1,\n\tmaxLength = Infinity,\n\tpattern   = null,\n\tfallback,\n\tpolicy,\n} = {}) {\n\tif (\n\t\ttypeof val === 'string'\n\t\t&& between(minLength, val.length, maxLength)\n\t\t&& (! (pattern instanceof RegExp) || pattern.test(val))\n\t) {\n\t\tsetAttr(el, attr, val, { policy });\n\t} else if(isTrustedType(val)) {\n\t\tconst str = val.toString();\n\n\t\tif (\n\t\t\tbetween(minLength, str.length, maxLength)\n\t\t\t&& (! (pattern instanceof RegExp) || pattern.test(str))\n\t\t) {\n\t\t\tsetAttr(el, attr, val, { policy });\n\t\t} else {\n\t\t\tel.removeAttribute(attr);\n\t\t}\n\t} else if (typeof fallback === 'string' || isTrustedType(fallback)) {\n\t\tsetString(el, attr, fallback, { pattern, policy, minLength, maxLength });\n\t} else {\n\t\tel.removeAttribute(attr);\n\t}\n}\n\nexport function getURL(el, attr, { base = document.baseURI } = {}) {\n\tif (el.hasAttribute(attr)) {\n\t\treturn new URL(el.getAttribute(attr), base);\n\t} else {\n\t\treturn null;\n\t}\n}\n\nexport function setURL(el, attr, val, {\n\tbase = document.baseURI,\n\trequirePath = false,\n\tpolicy,\n} = {}) {\n\tif ((val instanceof URL) && (! requirePath || val.pathname.length > 1)) {\n\t\tsetAttr(el, attr, val.href, { policy });\n\t} else if (typeof val === 'string' && val.length !== 0) {\n\t\tsetURL(el, attr, new URL(val, base), { requirePath });\n\t} else if (isScriptURL(val)) {\n\t\tconst url = new URL(val.toString(), document.baseURI);\n\n\t\tif (! requirePath || url.pathname.length > 1) {\n\t\t\tsetAttr(el, attr, val, { policy });\n\t\t} else {\n\t\t\tel.removeAttribute(attr);\n\t\t}\n\t} else {\n\t\tel.removeAttribute(attr);\n\t}\n}\n\nexport function getEnum(el, attr, {\n\tallowed  = [],\n\tfallback = undefined,\n}) {\n\tif (! Array.isArray(allowed) || allowed.length === 0) {\n\t\tthrow new TypeError('`allowed` must be a non-empty array.');\n\t} else if (el.hasAttribute(attr)) {\n\t\tconst val = el.getAttribute(attr);\n\t\treturn allowed.includes(val) ? val : fallback;\n\t} else {\n\t\treturn fallback;\n\t}\n}\n\nexport function setEnum(el, attr, val, {\n\tallowed = [],\n\tfallback = undefined,\n}) {\n\tif (! Array.isArray(allowed) || allowed.length === 0) {\n\t\tthrow new TypeError('`allowed` must be a non-empty array.');\n\t} else if (allowed.includes(val)) {\n\t\tsetAttr(el, attr, val);\n\t} else if (! isNullish(fallback)) {\n\t\tsetAttr(el, attr, fallback);\n\t} else {\n\t\tel.removeAttribute(attr);\n\t}\n}\n\nexport function getColor(el, attr, { fallback } = {}) {\n\tconst val = getString(el, attr);\n\treturn typeof val === 'string' && COLOR.test(val) ? val : fallback;\n}\n\nexport function setColor(el, attr, val, { fallback } = {}) {\n\tsetString(el, attr, val, { fallback, minLength: 3, maxLength: 9, pattern: COLOR });\n}\n\nexport function getRGB(el, attr, { fallback = '#000000' } = {}) {\n\tconst { red = 0, green = 0, blue = 0 } = parseHexColor(getColor(el, attr, { fallback }));\n\treturn { red, green, blue };\n}\n\nexport function setRGB(el, attr, { red = 0, green = 0, blue = 0 } = {}) {\n\tsetColor(el, attr, toHexColor({ red, green, blue }));\n}\n\nexport function getRGBA(el, attr, { fallback = '#000000' } = {}) {\n\tconst { red = 0, green = 0, blue = 0, alpha = 1 } = parseHexColor(getColor(el, attr, { fallback }));\n\treturn { red, green, blue, alpha };\n}\n\nexport function setRGBA(el, attr, { red = 0, green = 0, blue = 0, alpha = 1 } = {}) {\n\tsetColor(el, attr, toHexColor({ red, green, blue, alpha }));\n}\n\nexport { setAttr };\n","/**\n * @copyright 2023 Chris Zuber <admin@kernvalley.us>\n */\nexport function meta({ name, itemprop, property, content, parent = document.head, replace = true }) {\n\tconst created = document.createElement('meta');\n\tlet existing;\n\n\tif (typeof name === 'string') {\n\t\texisting = parent.querySelector(`meta[name=\"${CSS.escape(name)}\"]`);\n\t\tcreated.name = name;\n\t} else if (typeof itemprop === 'string') {\n\t\texisting = parent.querySelector(`meta[itemprop=\"${CSS.escape(itemprop)}\"]`);\n\t\tcreated.setAttribute('itemprop', itemprop);\n\t} else if (typeof property === 'string') {\n\t\texisting = parent.querySelector(`meta[property=\"${CSS.escape(property)}\"]`);\n\t\tcreated.setAttribute('property', property);\n\t}\n\n\tif (Array.isArray(content)) {\n\t\tcreated.content = content.join(', ');\n\t} else if (typeof content === 'string' || typeof content === 'number') {\n\t\tcreated.content = content;\n\t} else if (content instanceof URL) {\n\t\tcreated.content = content.href;\n\t} else if (typeof content === 'object') {\n\t\tcreated.content = Object.entries(content).map(([k, v]) => `${k}=${v}`).join(',');\n\t}\n\n\tif (! (parent instanceof Element)) {\n\t\treturn created;\n\t} else if (existing instanceof HTMLMetaElement && replace === true) {\n\t\texisting.replaceWith(created);\n\t\treturn created;\n\t} else {\n\t\tparent.append(created);\n\t\treturn created;\n\t}\n}\n\nexport function description(content) {\n\treturn [\n\t\tmeta({ name:     'description',         content }),\n\t\tmeta({ itemprop: 'description',         content }),\n\t\tmeta({ property: 'og:description',      content }),\n\t\tmeta({ name:     'twitter:description', content }),\n\t];\n}\n\nexport function keywords(content) {\n\treturn [\n\t\tmeta({ name:     'keywords',    content }),\n\t\tmeta({ itemprop: 'keywords',    content }),\n\t\tmeta({ property: 'og:keywords', content }),\n\t];\n}\n\nexport function referrer(content) {\n\treturn meta({ name: 'referrer', content });\n}\n\nexport function robots(content) {\n\treturn meta({ name: 'robots', content });\n}\n\nexport function thumbnail(content) {\n\treturn [\n\t\tmeta({ itemprop: 'thumbnailUrl',  content }),\n\t\tmeta({ property: 'og:image',      content}),\n\t\tmeta({ name:     'twitter:image', content }),\n\t];\n}\n\nexport function title(content) {\n\tdocument.title = content;\n\treturn [\n\t\tmeta({ itemprop: 'headline', content }),\n\t\tmeta({ prooperty: 'og:title', content }),\n\t];\n}\n\nexport function getDescription(base = document.head) {\n\tconst found = base.querySelector([\n\t\t'meta[name=\"description\"][content]',\n\t\t'meta[itemprop=\"description\"][content]',\n\t\t'meta[property=\"og:description\"][content]',\n\t\t'meta[name=\"twitter:description\"][content]',\n\t].join(','));\n\n\tif (found instanceof HTMLMetaElement) {\n\t\treturn found.content;\n\t} else {\n\t\treturn null;\n\t}\n}\n\nexport function getKeywords(base = document.head) {\n\tconst found = base.querySelector([\n\t\t'meta[name=\"keywords\"][content]',\n\t\t'meta[itemprop=\"keywords\"][content]',\n\t\t'meta[property=\"og:keywords\"][content]',\n\t].join(','));\n\n\tif (found instanceof HTMLMetaElement) {\n\t\treturn found.content.split(',').map(str => str.trim());\n\t} else {\n\t\treturn [];\n\t}\n}\n\nexport function getPageInfo() {\n\treturn {\n\t\ttitle: document.title,\n\t\tdescription: getDescription(),\n\t\tkeywords: getKeywords(),\n\t};\n}\n","/**\n * @copyright 2023 Chris Zuber <admin@kernvalley.us>\n */\nconst symbols = { resp: Symbol('resp') };\n\nexport class HTTPException extends Error {\n\tconstructor(resp = Response.error(), { message, cause } = {}) {\n\t\tsuper(\n\t\t\ttypeof message === 'string' ? message :`<${resp.url}> [${resp.status} ${resp.statusText}]`,\n\t\t\t{ cause }\n\t\t);\n\n\t\tObject.defineProperty(this, symbols.resp, {\n\t\t\tvalue: resp,\n\t\t\tconfigurable: false,\n\t\t\twritable: false,\n\t\t\tenumerable: false,\n\t\t});\n\t}\n\n\tasync json() {\n\t\treturn await this[symbols.resp].json();\n\t}\n\n\tasync text() {\n\t\treturn await this[symbols.resp].text();\n\t}\n\n\tget body() {\n\t\treturn this[symbols.resp].body;\n\t}\n\n\tget bodyUsed() {\n\t\treturn this[symbols.resp].bodyUsed;\n\t}\n\n\tget headers() {\n\t\treturn this[symbols.resp].headers;\n\t}\n\n\tget ok() {\n\t\treturn this[symbols.resp].ok;\n\t}\n\n\tget redirected() {\n\t\treturn this[symbols.resp].redirected;\n\t}\n\n\tget status() {\n\t\treturn this[symbols.resp].status;\n\t}\n\n\tget statusText() {\n\t\treturn this[symbols.resp].statusText;\n\t}\n\n\tget type() {\n\t\treturn this[symbols.resp].type;\n\t}\n\n\tget url() {\n\t\treturn this[symbols.resp].url;\n\t}\n\n\ttoJSON() {\n\t\tconst { status, statusText, ok, url, message, type, redirected } = this;\n\t\treturn { status, ok, statusText, url, message, type, redirected };\n\t}\n}\n","/**\n * @copyright 2021-2023 Chris Zuber <admin@kernvalley.us>\n */\nimport { parse } from './dom.js';\nimport { signalAborted } from './abort.js';\nimport { setURLParams, setUTMParams, isObject, isNullish, callOnce } from './utility.js';\nimport { isTrustPolicy } from './trust.js';\nimport { HTTPException } from './HTTPException.js';\nimport * as TYPES from './types.js';\n\nfunction filename(src) {\n\tif (typeof src === 'string') {\n\t\treturn new URL(src, location.origin).pathname.split('/').at(-1);\n\t} else {\n\t\treturn '';\n\t}\n}\n\nfunction getType({ headers }) {\n\tif (headers instanceof Headers && headers.has('Content-Type')) {\n\t\treturn headers.get('Content-Type').split(';')[0];\n\t} else {\n\t\treturn null;\n\t}\n}\n\nfunction handleResponse(resp, { cause, message } = {}) {\n\tif (! (resp instanceof Response)) {\n\t\tthrow new TypeError('Expected a Response object');\n\t} else if (! resp.ok) {\n\t\tthrow new HTTPException(resp, { cause, message });\n\t} else {\n\t\treturn resp;\n\t}\n}\n\nfunction handleError(err) {\n\tif (err instanceof HTTPException) {\n\t\tthrow err;\n\t} else if (err instanceof Error) {\n\t\tthrow new HTTPException(Response.error(), { cause: err, message: err.message });\n\t} else if (typeof err === 'string') {\n\t\tthrow new HTTPException(Response.error(), {\n\t\t\tcause: new DOMException('Unknown network error'),\n\t\t\tmessage: err,\n\t\t});\n\t} else {\n\t\tthrow new HTTPException(Response.error(), {\n\t\t\tcause: new DOMException('Unknown network error'),\n\t\t\tmessage: 'Unknown network error',\n\t\t});\n\t}\n}\n\nexport async function fetch(url, opts = {}) {\n\tif (opts.signal instanceof AbortSignal && opts.signal.aborted) {\n\t\tthrow new HTTPException(Response.error(), {\n\t\t\tcause: opts.signal.reason,\n\t\t\tmessage: opts.signal.reason instanceof Error ? opts.signal.reason.message : opts.signal.reason,\n\t\t});\n\t} else if (opts.signal instanceof AbortSignal && ! ('signal' in Request.prototype)) {\n\t\treturn await Promise.race([\n\t\t\tglobalThis.fetch(url, opts),\n\t\t\tsignalAborted(opts.signal),\n\t\t]).then(resp => handleResponse(resp, { message: opts.errorMessage }), handleError);\n\t} else {\n\t\treturn await globalThis.fetch(url, opts).then(resp => handleResponse(resp, { message: opts.errorMessage }), handleError);\n\t}\n}\n\nexport const getHTTPCSP = callOnce(async function getHTTPCSP() {\n\tconst { ok, headers } = await fetch(location.href, { method: 'HEAD' });\n\n\tif (ok && headers.has('Content-Security-Policy')) {\n\t\tconst directives = headers.get('Content-Security-Policy').trim().split(';').filter(str => str.length !== 0);\n\n\t\treturn Object.fromEntries(directives.map(directive => {\n\t\t\tconst [key, ...rest] = directive.trim().split(' ').filter(part => part.length !== 0);\n\t\t\treturn [key, rest];\n\t\t}));\n\t}\n});\n\nexport const getCSP = callOnce(async function getCSP() {\n\ttry {\n\t\tconst csp = await getHTTPCSP();\n\n\t\tif (typeof csp === 'object' && ! Object.is(csp, null)) {\n\t\t\treturn csp;\n\t\t} else {\n\t\t\treturn getMetaCSP();\n\t\t}\n\t} catch(err) {\n\t\tconsole.error(err);\n\t\treturn getMetaCSP();\n\t}\n});\n\nexport function getMetaCSP() {\n\tconst meta = document.head.querySelector('meta[http-equiv=\"Content-Security-Policy\"][content]');\n\n\tif (meta instanceof HTMLMetaElement) {\n\t\tconst directives = meta.content.trim().split(';').filter(str => str.length !== 0);\n\n\t\treturn Object.fromEntries(directives.map(directive => {\n\t\t\tconst [key, ...rest] = directive.trim().split(' ').filter(part => part.length !== 0);\n\t\t\treturn [key, rest];\n\t\t}));\n\t} else {\n\t\treturn {};\n\t}\n}\n\nexport async function GET(url, {\n\tbody = undefined,\n\tmode = 'cors',\n\tcache = 'default',\n\tcredentials = 'omit',\n\tredirect = 'follow',\n\tpriority  ='auto',\n\treferrerPolicy = 'no-referrer',\n\theaders = new Headers(),\n\tintegrity = undefined,\n\tkeepalive = undefined,\n\tsignal = undefined,\n\ttimeout = null,\n\terrorMessage,\n} = {}) {\n\tif (typeof body !== 'undefined') {\n\t\turl = setURLParams(url, body);\n\t} else if (typeof url === 'string') {\n\t\turl = new URL(url, document.baseURI);\n\t}\n\n\tif (typeof signal === 'undefined' && Number.isInteger(timeout)) {\n\t\tsignal = AbortSignal.timeout(timeout);\n\t} else if (signal instanceof AbortController) {\n\t\tsignal = signal.signal;\n\t}\n\n\treturn await fetch(url, { method: 'GET', mode, credentials, referrerPolicy,\n\t\theaders, cache, redirect, priority, integrity, keepalive, signal, errorMessage });\n}\n\nexport async function POST(url, {\n\tbody = undefined,\n\tmode = 'cors',\n\tcache = 'default',\n\tcredentials = 'omit',\n\tpriority = 'auto',\n\tredirect = 'follow',\n\treferrerPolicy = 'no-referrer',\n\theaders = new Headers(),\n\tintegrity = undefined,\n\tkeepalive = undefined,\n\tsignal = undefined,\n\ttimeout = null,\n\terrorMessage,\n} = {}) {\n\tif (typeof body === 'object' && ! (body instanceof FormData)) {\n\t\tif (body instanceof HTMLFormElement) {\n\t\t\tbody = new FormData(body);\n\t\t} else if (body instanceof File) {\n\t\t\tlet file;\n\t\t\t[body, file] = [new FormData(), body];\n\t\t\t// @TODO figure out a default param name for the file\n\t\t\t// @TODO handle multiple files and arrays containing files\n\t\t\tbody.set(file.name, file, file.name);\n\t\t} else {\n\t\t\tbody = JSON.stringify(body);\n\n\t\t\tif (headers instanceof Headers && ! headers.has('Content-Type')) {\n\t\t\t\theaders.set('Content-Type', TYPES.JSON);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (typeof signal === 'undefined' && Number.isInteger(timeout)) {\n\t\tsignal = AbortSignal.timeout(timeout);\n\t} else if (signal instanceof AbortController) {\n\t\tsignal = signal.signal;\n\t}\n\n\treturn await fetch(url, { method: 'POST', body, mode, credentials, referrerPolicy,\n\t\theaders, cache, redirect, priority, integrity, keepalive, signal, errorMessage });\n}\n\nexport async function DELETE(url, {\n\tbody = undefined,\n\tmode = 'cors',\n\tcache = 'default',\n\tcredentials = 'omit',\n\tredirect = 'follow',\n\tpriority = 'auto',\n\treferrerPolicy = 'no-referrer',\n\theaders = new Headers(),\n\tintegrity = undefined,\n\tkeepalive = undefined,\n\tsignal = undefined,\n\ttimeout = null,\n\terrorMessage,\n} = {}) {\n\tif (typeof body !== 'undefined') {\n\t\turl = setURLParams(url, body);\n\t} else if (typeof url === 'string') {\n\t\turl = new URL(url, document.baseURI);\n\t}\n\n\tif (typeof signal === 'undefined' && Number.isInteger(timeout)) {\n\t\tsignal = AbortSignal.timeout(timeout);\n\t} else if (signal instanceof AbortController) {\n\t\tsignal = signal.signal;\n\t}\n\n\treturn await fetch(url, { method: 'DELETE', mode, credentials, referrerPolicy,\n\t\theaders, cache, redirect, priority, integrity, keepalive, signal, errorMessage });\n}\n\nexport async function getHTML(url, {\n\tbody = undefined,\n\tmode = 'cors',\n\tcache = 'default',\n\tcredentials = 'omit',\n\tredirect = 'follow',\n\tpriority = 'auto',\n\treferrerPolicy = 'no-referrer',\n\theaders = new Headers({ Accept: TYPES.HTML }),\n\tintegrity = undefined,\n\tkeepalive = undefined,\n\tsignal = undefined,\n\ttimeout = null,\n\thead = true,\n\tasFrag = true,\n\tsanitizer = undefined,\n\tpolicy,\n\terrorMessage,\n} = {}) {\n\tconst html = await getText(url, { body, mode, credentials, referrerPolicy, headers,\n\t\tcache, redirect, priority, integrity, keepalive, signal, timeout, errorMessage });\n\n\tif (isTrustPolicy(policy)) {\n\t\treturn parse(policy.createHTML(html), { asFrag, head });\n\t} else {\n\t\treturn parse(html, { head, asFrag, sanitizer, policy });\n\t}\n}\n\nexport const createTemplateGetter = (...args) => callOnce(() => getHTML(...args));\n\nexport async function getText(url, {\n\tbody = undefined,\n\tmode = 'cors',\n\tcache = 'default',\n\tcredentials = 'omit',\n\tredirect = 'follow',\n\tpriority = 'auto',\n\treferrerPolicy = 'no-referrer',\n\theaders = new Headers({ Accept: TYPES.TEXT }),\n\tintegrity = undefined,\n\tkeepalive = undefined,\n\tsignal = undefined,\n\ttimeout = null,\n\terrorMessage,\n} = {}) {\n\tconst resp = await GET(url, { body, mode, credentials, referrerPolicy, headers,\n\t\tcache, redirect, priority, integrity, keepalive, signal, timeout, errorMessage });\n\n\treturn await resp.text();\n}\n\nexport async function getJSON(url, {\n\tbody = undefined,\n\tmode = 'cors',\n\tcache = 'default',\n\tcredentials = 'omit',\n\tredirect = 'follow',\n\treferrerPolicy = 'no-referrer',\n\tpriority = 'auto',\n\theaders = new Headers({ Accept: TYPES.JSON }),\n\tintegrity = undefined,\n\tkeepalive = undefined,\n\tsignal = undefined,\n\ttimeout = null,\n\terrorMessage,\n} = {}) {\n\tconst resp = await GET(url, { body, mode, credentials, referrerPolicy, headers,\n\t\tcache, redirect, priority, integrity, keepalive, signal, timeout, errorMessage });\n\n\treturn await resp.json();\n}\n\nexport async function getFile(url, {\n\tname = null,\n\tbody = undefined,\n\tmode = 'cors',\n\tcache = 'default',\n\tcredentials = 'omit',\n\tredirect = 'follow',\n\treferrerPolicy = 'no-referrer',\n\tpriority = 'auto',\n\theaders = new Headers(),\n\tintegrity = undefined,\n\tkeepalive = undefined,\n\tsignal = undefined,\n\ttimeout = null,\n\terrorMessage,\n} = {}) {\n\tif (typeof name !== 'string') {\n\t\tname = filename(url);\n\t}\n\n\tconst resp = await GET(url, { body, mode, credentials, referrerPolicy, headers,\n\t\tcache, redirect, priority, integrity, keepalive, signal, timeout, errorMessage });\n\n\tconst type = getType(resp);\n\treturn new File([await resp.blob()], name, { type });\n}\n\nexport async function submitForm(form) {\n\tif (typeof form === 'string') {\n\t\treturn await submitForm(document.forms[form]);\n\t} else if (form instanceof Event) {\n\t\tform.preventDefault();\n\t\treturn await submitForm(form.target);\n\t} else if (form instanceof HTMLFormElement) {\n\t\tswitch (form.method.toLowerCase()) {\n\t\t\tcase 'get':\n\t\t\t\treturn GET(form.action, { body: new FormData(form) });\n\n\t\t\tcase 'post':\n\t\t\t\treturn POST(form.action, { body: new FormData(form) });\n\n\t\t\tcase 'delete':\n\t\t\t\treturn DELETE(form.action, { body: new FormData(form) });\n\n\t\t\tdefault:\n\t\t\t\tthrow new Error(`Unsupported method: ${form.method}`);\n\t\t}\n\t}\n}\n\nexport const getManifest = callOnce(async function getManifest({ timeout, signal } = {}) {\n\tconst resp = await getLink('link[rel=\"manifest\"][href]', { timeout, signal });\n\treturn await resp.json();\n});\n\nexport async function getLink(link, { timeout, signal } = {}) {\n\tif (typeof link === 'string') {\n\t\treturn await getLink(document.querySelector(link, { timeout, signal }));\n\t} else if (! (link instanceof HTMLLinkElement)) {\n\t\tthrow new DOMException('Expected a <link>');\n\t} else if (link.href.length === 0) {\n\t\tthrow new DOMException('Missing `href` on <link>');\n\t} else {\n\t\tconst { href, integrity, type, referrerPolicy, crossOrigin } = link;\n\n\t\tlet credentials;\n\t\tconst mode = typeof crossOrigin === 'string' ? 'cors' : 'no-cors';\n\t\tconst headers = new Headers();\n\n\t\tif (mode === 'cors') {\n\t\t\tcredentials = crossOrigin === 'use-credentials' ? 'include' : 'omit';\n\t\t}\n\n\t\tif (typeof type === 'string') {\n\t\t\theaders.set('Accept', type);\n\t\t}\n\n\t\treturn await GET(href, { mode, credentials, headers, integrity, referrerPolicy, timeout, signal });\n\t}\n}\n\nexport async function postHTML(url, {\n\tbody = undefined,\n\tmode = 'cors',\n\tcache = 'default',\n\tcredentials = 'omit',\n\tredirect = 'follow',\n\treferrerPolicy = 'no-referrer',\n\tpriority = 'auto',\n\theaders = new Headers({ Accept: TYPES.HTML }),\n\tintegrity = undefined,\n\tkeepalive = undefined,\n\tsignal = undefined,\n\ttimeout = null,\n\thead = true,\n\tasFrag = true,\n\tsanitizer = undefined,\n\tpolicy,\n\terrorMessage,\n} = {}) {\n\tconst html = await postText(url, { body, mode, credentials, referrerPolicy, headers,\n\t\tcache, redirect, priority, integrity, keepalive, signal, timeout, errorMessage });\n\n\treturn parse(html, { head, asFrag, sanitizer, policy });\n}\n\nexport async function postJSON(url, {\n\tbody = undefined,\n\tmode = 'cors',\n\tcache = 'default',\n\tcredentials = 'omit',\n\tredirect = 'follow',\n\treferrerPolicy = 'no-referrer',\n\tpriority = 'auto',\n\theaders = new Headers({ Accept: TYPES.JSON }),\n\tintegrity = undefined,\n\tkeepalive = undefined,\n\tsignal = undefined,\n\ttimeout = null,\n\terrorMessage,\n} = {}) {\n\tconst resp = await POST(url, { body, mode, credentials, referrerPolicy, headers,\n\t\tcache, redirect, priority, integrity, keepalive, signal, timeout, errorMessage });\n\n\treturn await resp.json();\n}\n\nexport async function postText(url, {\n\tbody = undefined,\n\tmode = 'cors',\n\tcache = 'default',\n\tcredentials = 'omit',\n\tredirect = 'follow',\n\treferrerPolicy = 'no-referrer',\n\tpriority = 'auto',\n\theaders = new Headers({ Accept: TYPES.TEXT }),\n\tintegrity = undefined,\n\tkeepalive = undefined,\n\tsignal = undefined,\n\ttimeout = null,\n\terrorMessage,\n} = {}) {\n\tconst resp = await POST(url, { body, mode, credentials, referrerPolicy, headers,\n\t\tcache, redirect, priority, integrity, keepalive, signal, timeout, errorMessage });\n\n\treturn await resp.text();\n}\n\nexport function navigateTo(to, {\n\tparams = {},\n\tutm: {\n\t\tsource: utm_source,\n\t\tmedium: utm_medium = 'referral',\n\t\tcontent: utm_content,\n\t\tcampaign: utm_campaign,\n\t\tterm: utm_term,\n\t} = {},\n\tallowedOrigins = [],\n\trequirePath = false,\n\torigin = location.origin,\n} = {}) {\n\tconst url = new URL(to, origin);\n\n\tif (! Array.isArray(allowedOrigins)) {\n\t\tthrow new TypeError('`allowedOrigins` must be an array');\n\t} else if (! (url.origin === location.origin || allowedOrigins.includes(url.origin))) {\n\t\tthrow new TypeError(`${url.origin} is not an allowed origin`);\n\t} else if (requirePath && url.pathname.length === 1) {\n\t\tthrow new TypeError('`pathname` is required');\n\t} else if (! isObject(params)) {\n\t\tthrow new TypeError('Expected `params` to be an object');\n\t} else {\n\t\tif (typeof utm_source === 'string') {\n\t\t\tObject.entries({...params, utm_source, utm_medium, utm_content, utm_campaign, utm_term })\n\t\t\t\t.filter(([,v]) => ! isNullish(v))\n\t\t\t\t.forEach(([k, v]) => url.searchParams.set(k, v));\n\t\t} else {\n\t\t\tObject.entries(params)\n\t\t\t\t.filter(([,v]) => ! isNullish(v))\n\t\t\t\t.forEach(([k, v]) => url.searchParams.set(k, v));\n\t\t}\n\n\t\tlocation.href = url.href;\n\t}\n}\n\nexport function postNav(url, data = {}, {\n\ttarget = '_self' ,\n\tenctype = TYPES.FORM_URL_ENCODED,\n\tsignal,\n} = {}) {\n\tif (! (signal instanceof AbortSignal && signal.aborted)) {\n\t\tconst form = document.createElement('form');\n\t\tconst inputs = Object.entries(data).map(([name, value]) => {\n\t\t\tconst input = document.createElement('input');\n\t\t\tinput.name = name;\n\t\t\tinput.type = 'hidden';\n\t\t\tinput.readOnly = true;\n\t\t\tinput.value = value;\n\t\t\treturn input;\n\t\t});\n\n\t\tform.action = url;\n\t\tform.method = 'POST';\n\t\tform.target = target;\n\t\tform.enctype = enctype;\n\t\tform.hidden = true;\n\t\tform.append(...inputs);\n\t\tform.addEventListener('submit', ({ target }) => setTimeout(() => target.remove(), 100), { signal });\n\n\t\trequestAnimationFrame(() => {\n\t\t\tdocument.body.append(form);\n\t\t\tform.submit();\n\t\t});\n\t}\n}\n\nexport { setURLParams, setUTMParams };\n","/**\n * @copyright 2021-2023 Chris Zuber <admin@kernvalley.us>\n */\nimport { loadScript } from './loader.js';\nexport const trustPolicies = ['goog#html'];\n\nif (! Array.isArray(window.dataLayer)) {\n\twindow.dataLayer = [];\n}\n\nexport function ga(...args) {\n\tif (window.ga instanceof Function) {\n\t\treturn window.ga(...args);\n\t}\n}\n\nexport async function ready(timeout = 2000) {\n\tawait new Promise((resolve, reject) => {\n\t\tif (! hasGa()) {\n\t\t\treject(new DOMException('Google Analytics script not loaded'));\n\t\t} else {\n\t\t\tconst id = setTimeout(() => reject(new DOMException('GA ready callback timed-out')), timeout);\n\n\t\t\tga(() => {\n\t\t\t\tclearTimeout(id);\n\t\t\t\tresolve();\n\t\t\t});\n\t\t}\n\t});\n}\n\nexport function getUTMParams(search = window.location.search) {\n\tconst params = new URLSearchParams(search);\n\treturn  {\n\t\tcampaign: params.get('utm_campaign'),\n\t\tcontent: params.get('utm_content'),\n\t\tmedium: params.get('utm_medium'),\n\t\tsource: params.get('utm_source'),\n\t\tterm: params.get('utm_term'),\n\t};\n}\n\nexport async function create(...args) {\n\tawait ready();\n\treturn ga('create', ...args);\n}\n\nexport async function remove() {\n\tawait ready();\n\treturn ga('remove');\n}\n\nexport async function get(prop, timeout = 150) {\n\treturn await getTracker(timeout).then(tracker => tracker.get(prop));\n}\n\nexport async function getTracker(timeout = 150) {\n\tif (hasGa()) {\n\t\treturn await new Promise(async (resolve, reject) => {\n\t\t\tconst id = setTimeout(() => reject(new DOMException('Timeout obtaining tracker')), timeout);\n\n\t\t\tga(tracker => {\n\t\t\t\tif (typeof tracker !== 'undefined') {\n\t\t\t\t\tclearTimeout(id);\n\t\t\t\t\tresolve(tracker);\n\t\t\t\t} else {\n\t\t\t\t\treject(new DOMException('Unable to obtain GA tracker'));\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t} else {\n\t\tnew DOMException('Google Analytics script not loaded');\n\t}\n}\n\nexport async function set(...args) {\n\tawait ready();\n\treturn ga('set', ...args);\n}\n\nexport async function require(...args) {\n\tawait ready();\n\treturn ga('require', ...args);\n}\n\nexport async function provide(...args) {\n\tawait ready();\n\treturn ga('provide', ...args);\n}\n\nexport async function location(url = window.location.href) {\n\treturn set('page', url);\n}\n\nexport async function pageView(page = window.location.pathname) {\n\treturn send({ hitType: 'pageview', page });\n}\n\nexport async function send({\n\teventCategory,\n\teventAction,\n\teventValue,\n\teventLabel,\n\thitType       = 'event',\n\ttransport     = 'beacon',\n} = {}) {\n\tawait new Promise(async(hitCallback, reject) => {\n\t\tif (hasGa()) {\n\t\t\tawait ready();\n\t\t\tga('send', { hitType, eventCategory, eventAction, eventLabel,\n\t\t\t\teventValue, transport, hitCallback });\n\t\t} else {\n\t\t\treject(new Error('ga has not been successfully initialized'));\n\t\t}\n\t});\n}\n\nexport function gtag() {\n\twindow.dataLayer.push(arguments);\n}\n\nexport function hasGa() {\n\treturn window.ga instanceof Function;\n}\n\nexport async function importGa(id, params = {}, { policy } = {}) {\n\tconst url = new URL('https://www.googletagmanager.com/gtag/js');\n\turl.searchParams.set('id', id);\n\tObject.entries(params).forEach(([k, v]) => url.searchParams.set(k, v));\n\n\tawait loadScript(url.href, { crossOrigin: 'use-credentials', policy, }).then(() => {\n\t\tgtag('js', new Date());\n\t\tgtag('config', id);\n\t\tcreate(id, 'auto');\n\t}).catch(console.error);\n\n\treturn { gtag, ga, send, get, set, ready, create, remove, require,\n\t\tlocation, pageView, getTracker, getUTMParams, hasGa };\n}\n\nexport function externalHandler() {\n\tif (hasGa()) {\n\t\tsend({\n\t\t\thitType: 'event',\n\t\t\teventCategory: 'outbound',\n\t\t\teventAction: 'click',\n\t\t\teventLabel: this.href,\n\t\t\ttransport: 'beacon',\n\t\t});\n\t}\n}\n\nexport function telHandler() {\n\tif (hasGa()) {\n\t\tsend({\n\t\t\thitType: 'event',\n\t\t\teventCategory: 'call',\n\t\t\teventLabel: this.href.replace('tel:', '').trim(),\n\t\t\ttransport: 'beacon',\n\t\t});\n\t}\n}\n\nexport function mailtoHandler() {\n\tif (hasGa()) {\n\t\tsend({\n\t\t\thitType: 'event',\n\t\t\teventCategory: 'email',\n\t\t\teventLabel: this.href.replace('mailto:', '').trim(),\n\t\t\ttransport: 'beacon',\n\t\t});\n\t}\n}\n\nexport function geoHandler() {\n\tif (hasGa()) {\n\t\tsend({\n\t\t\thitType: 'event',\n\t\t\teventCategory: 'geo',\n\t\t\teventLabel: this.href.replace('geo:', '').trim(),\n\t\t\ttransport: 'beacon',\n\t\t});\n\t}\n}\n\nexport function genericHandler() {\n\tif (hasGa()) {\n\t\tconst {\n\t\t\thitType = 'event', eventCategory = 'unknown', eventLabel = 'unknown',\n\t\t\ttransport = 'beacon',\n\t\t} = this.dataset;\n\t\tsend({ hitType, eventCategory, eventLabel, transport });\n\t}\n}\n","import { HTMLCustomButtonElement } from './custom.js';\nimport { registerCustomElement } from '@shgysk8zer0/kazoo/custom-elements.js';\nimport { getString, setString, getURL, setURL } from '@shgysk8zer0/kazoo/attrs.js';\nimport { setUTMParams } from '@shgysk8zer0/kazoo/utility.js';\nimport { getDescription } from '@shgysk8zer0/kazoo/meta.js';\nimport { hasGa, send } from '@shgysk8zer0/kazoo/google-analytics.js';\nimport { GET } from '@shgysk8zer0/kazoo/http.js';\n\nconst protectedData = new WeakMap();\n\nfunction log({ url: eventAction, title: eventLabel, hitType = 'event',\n\ttransport = 'beacon', eventCategory = 'share-button'\n}) {\n\tif (hasGa()) {\n\t\tsend({ hitType, eventCategory, eventAction, eventLabel, transport });\n\t}\n}\n\nasync function getFiles(file) {\n\tif (! (file instanceof URL) || ! (navigator.canShare instanceof Function)) {\n\t\treturn [];\n\t} else {\n\t\ttry {\n\t\t\tconst resp = await GET(file);\n\n\t\t\tif (! resp.ok) {\n\t\t\t\tthrow new Error(`Failed fetching ${file} [${resp.status} ${resp.statusText}]`);\n\t\t\t} else if (! resp.headers.has('Content-Type')) {\n\t\t\t\tthrow new Error(`Unknown Content-Type for ${file}`);\n\t\t\t} else {\n\t\t\t\tconst name = file.pathname.split('/').at(-1);\n\t\t\t\tconst type = resp.headers.get('Content-Type').split(';')[0];\n\t\t\t\tconst files = [new File([await resp.blob()], name, { type })];\n\t\t\t\treturn navigator.canShare({ title: 'test', files }) ? files : [];\n\t\t\t}\n\t\t} catch(err) {\n\t\t\tconsole.error(err);\n\t\t\treturn [];\n\t\t}\n\t}\n}\n\nasync function share({ currentTarget, type, key, isTrusted }) {\n\tif (isTrusted && ! currentTarget.disabled && type === 'click' || (type === 'keydown' && key === ' ')) {\n\t\tconst { internals } = protectedData.get(currentTarget);\n\t\tconst { shareTitle: title, text, campaign, content, medium, source, term , file } = currentTarget;\n\t\tconst url = setUTMParams(this.url, { campaign, content, medium, source, term });\n\n\t\tinternals.ariaPressed = 'true';\n\t\tinternals.ariaBusy = 'true';\n\t\tthis.disabled = true;\n\t\tconst files = await getFiles(file);\n\t\tawait navigator.share({ title, text, url, files }).then(() => log({ url, title })).catch(console.error);\n\t\tinternals.ariaPressed = 'false';\n\t\tinternals.ariaBusy = 'false';\n\t\tthis.disabled = false;\n\t}\n}\n\nregisterCustomElement('share-button', class HTMLShareButtonElement extends HTMLCustomButtonElement {\n\tconstructor() {\n\t\tsuper();\n\t\tprotectedData.set(this, { internals: this.attachInternals() });\n\t}\n\n\tconnectedCallback() {\n\t\tsuper.connectedCallback();\n\t\tconst { internals } = protectedData.get(this);\n\t\tinternals.ariaPressed = 'false';\n\n\t\tif (! this.hasAttribute('aria-label')) {\n\t\t\tinternals.ariaLabel = 'Share this';\n\t\t}\n\n\t\tif (HTMLShareButtonElement.supported) {\n\t\t\tinternals.ariaHasPopup = 'dialog';\n\t\t\tthis.disabled = false;\n\t\t\tthis.addEventListener('click', share);\n\t\t\tthis.addEventListener('keydown', share);\n\t\t} else {\n\t\t\tthis.disabled = true;\n\t\t}\n\t}\n\n\tget canShare() {\n\t\treturn navigator.canShare instanceof Function && navigator.canShare({\n\t\t\ttitle: this.shareTitle,\n\t\t\ttext: this.text,\n\t\t\turl: this.url,\n\t\t});\n\t}\n\n\tget campaign() {\n\t\treturn getString(this, 'campaign');\n\t}\n\n\tset campaign(val) {\n\t\tsetString(this, 'campaign', val);\n\t}\n\n\tget content() {\n\t\treturn getString(this, 'content', { fallback: 'share-button' });\n\t}\n\n\tset content(val) {\n\t\tsetString(this, 'content', val);\n\t}\n\n\tget file() {\n\t\treturn getURL(this, 'file');\n\t}\n\n\tset file(val) {\n\t\tsetString(this, 'file', val);\n\t}\n\n\tget medium() {\n\t\treturn getString(this, 'medium', { fallback: 'share' });\n\t}\n\n\tset medium(val) {\n\t\tsetString(this, 'medium', val);\n\t}\n\n\tget shareTitle() {\n\t\treturn getString(this, 'sharetitle', { fallback: document.title });\n\t}\n\n\tset shareTitle(val) {\n\t\tsetString(this, 'sharetitle', val);\n\t}\n\n\tget source() {\n\t\treturn getString(this, 'source');\n\t}\n\n\tset source(val) {\n\t\tsetString(this, 'source', val);\n\t}\n\n\tget term() {\n\t\treturn getString(this, 'term');\n\t}\n\n\tset term(val) {\n\t\tsetString(this, 'term', val);\n\t}\n\n\tget text() {\n\t\treturn getString(this, 'text', { fallback: getDescription() });\n\t}\n\n\tset text(val) {\n\t\tsetString(this, 'text', val);\n\t}\n\n\tget url() {\n\t\treturn getURL(this, 'url');\n\t}\n\n\tset url(val) {\n\t\tsetURL(this, 'url', val);\n\t}\n\n\tstatic get supported() {\n\t\treturn navigator.share instanceof Function;\n\t}\n});\n"],"names":["protectedData","WeakMap","states","HTMLCustomButtonElement","HTMLElement","attachInternals","internals","super","set","this","disabled","hasAttribute","val","toggleAttribute","attributeChangedCallback","name","oldVal","newVal","get","ariaDisabled","add","delete","connectedCallback","has","role","tabIndex","observedAttributes","supported","window","customElements","Object","between","min","max","isNumber","num","Number","isNaN","features","el","document","createElement","eventFeatures","nativeSignal","globalThis","AbortController","prototype","hasOwnProperty","signal","passive","capture","once","options","addEventListener","removeEventListener","err","console","error","seal","getEventFeatures","listen","target","event","callback","EventTarget","aborted","signalAborted","finally","setAttr","attr","elementNs","policy","tagName","attribute","trustedTypes","getAttributeType","toLowerCase","setAttributeNs","createScriptURL","setAttribute","setAttributeNS","createScript","createHTML","createPolicy","Function","isTrustPolicy","TrustedTypePolicy","isScriptURL","input","URL","isTrustedType","isHTML","isScript","getDefaultPolicy","defaultPolicy","readyStates","readyStateIndex","state","readyState","indexOf","async","whenReadyState","resolve","reject","promise","getDeferred","stateIndex","AbortSignal","reason","DOMException","controller","settled","abort","deferred","Promise","throwIfAborted","callOnce","funcs","registerServiceWorker","source","scope","type","updateViaCache","navigator","serviceWorker","register","then","catch","TypeError","isNullish","is","Array","isArray","length","Date","getTime","thisArg","args","what","constructor","retVal","apply","setURLParams","forURL","params","url","baseURI","HTMLFormElement","FormData","URLSearchParams","fromEntries","thing","entries","forEach","k","v","searchParams","toString","setUTMParams","utm_source","medium","utm_medium","content","utm_content","campaign","utm_campaign","term","utm_term","getString","fallback","getAttribute","setString","minLength","maxLength","Infinity","pattern","RegExp","test","str","removeAttribute","getURL","base","setURL","requirePath","pathname","href","getDescription","head","found","querySelector","join","HTMLMetaElement","documentElement","dataset","ready","update","whenDefined","body","requireInteraction","actions","title","action","close","location","reload","reloadOnUpdate","symbols","resp","Symbol","HTTPException","Error","Response","message","cause","status","statusText","defineProperty","value","configurable","writable","enumerable","json","text","bodyUsed","headers","ok","redirected","toJSON","handleResponse","handleError","fetch","opts","Request","race","errorMessage","getHTTPCSP","method","directives","trim","split","filter","map","directive","key","rest","part","getMetaCSP","meta","GET","mode","cache","credentials","redirect","priority","referrerPolicy","Headers","integrity","keepalive","timeout","isInteger","getLink","link","HTMLLinkElement","crossOrigin","ga","send","eventCategory","eventAction","eventValue","eventLabel","hitType","transport","hitCallback","hasGa","id","setTimeout","clearTimeout","csp","dataLayer","share","currentTarget","isTrusted","shareTitle","file","ariaPressed","ariaBusy","files","canShare","at","File","blob","getFiles","log","tag","cls","tags","every","isDefined","warn","define","registerCustomElement","HTMLShareButtonElement","ariaLabel","ariaHasPopup"],"mappings":"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"}